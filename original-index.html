<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒãƒ¼ãƒˆãƒãƒªã‚¹ å¥‘ç´„ä¼æ¥­å‘ã‘ãƒãƒ¼ã‚¿ãƒ«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#2563eb',
                        'secondary': '#64748b',
                        'danger': '#dc2626',
                        'warning': '#d97706',
                        'success': '#059669',
                        'info': '#2563eb'
                    },
                    fontFamily: {
                        'jp': ['Hiragino Kaku Gothic ProN', 'ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN W3', 'ãƒ¡ã‚¤ãƒªã‚ª', 'Meiryo', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style>
        /* å°åˆ·ã‚¹ã‚¿ã‚¤ãƒ« */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { font-size: 12pt; color: black; }
            .print-break { page-break-before: always; }
        }
        .print-only { display: none; }
        
        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒªãƒ³ã‚°ï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰ */
        .focus-ring:focus {
            outline: 2px solid #2563eb;
            outline-offset: 2px;
        }

        /* ====================
         * ğŸ“± ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨UIå¼·åŒ–
         * ==================== */
        
        /* ã‚¿ãƒƒãƒæ“ä½œæœ€é©åŒ– */
        @media (hover: none) {
            .hover-touch {
                background-color: rgba(59, 130, 246, 0.1);
                transform: scale(0.98);
                transition: all 0.1s ease;
            }
            
            button, .btn, .nav-link {
                min-height: 44px; /* Appleæ¨å¥¨ã®ã‚¿ãƒƒãƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆ */
                min-width: 44px;
            }
        }

        /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç¸¦å‘ãï¼ˆ320pxã€œ480pxï¼‰ */
        @media (max-width: 480px) {
            /* ãƒ˜ãƒƒãƒ€ãƒ¼èª¿æ•´ */
            header .flex {
                padding: 0.5rem 1rem;
            }
            
            header h1 {
                font-size: 1.1rem;
            }
            
            /* ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚’ä¸‹éƒ¨å›ºå®š */
            .mobile-bottom-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                border-top: 1px solid #e5e7eb;
                z-index: 50;
                padding: 0.5rem 0;
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            }
            
            .mobile-nav-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 0.25rem;
                padding: 0 0.5rem;
            }
            
            .mobile-nav-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 0.5rem;
                text-decoration: none;
                color: #6b7280;
                font-size: 0.75rem;
                border-radius: 0.5rem;
                transition: all 0.2s ease;
                min-height: 60px;
            }
            
            .mobile-nav-item.active {
                color: #2563eb;
                background-color: #eff6ff;
            }
            
            .mobile-nav-item i {
                font-size: 1.2rem;
                margin-bottom: 0.25rem;
            }
            
            /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¸‹éƒ¨ãƒãƒ¼ã‚¸ãƒ³ */
            main {
                padding-bottom: 80px !important;
            }
            
            /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã«å¤‰æ›´ */
            .mobile-card-view {
                display: none;
            }
            
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            /* ã‚¹ãƒãƒ›ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚«ãƒ¼ãƒ‰è¡¨ç¤º */
            @media (max-width: 640px) {
                .desktop-table {
                    display: none;
                }
                
                .mobile-card-view {
                    display: block;
                }
            }
            
            /* ãƒ•ã‚©ãƒ¼ãƒ æœ€é©åŒ– */
            input, select, textarea {
                font-size: 16px !important; /* iOSæ‹¡å¤§é˜²æ­¢ */
            }
            
            /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ */
            .modal-mobile-full {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                margin: 0 !important;
                border-radius: 0 !important;
                max-width: none !important;
                height: 100vh !important;
            }
        }

        /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³æ¨ªå‘ãï¼ˆ481pxã€œ768pxï¼‰ */
        @media (min-width: 481px) and (max-width: 768px) and (orientation: landscape) {
            .landscape-optimized {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
        }

        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆï¼ˆ769pxã€œ1024pxï¼‰ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .tablet-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
            }
            
            .tablet-sidebar {
                position: sticky;
                top: 1rem;
                height: fit-content;
            }
        }

        /* PWAå¯¾å¿œ */
        .pwa-install-prompt {
            position: fixed;
            bottom: 90px;
            left: 1rem;
            right: 1rem;
            background: #1f2937;
            color: white;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateY(100px);
            transition: transform 0.3s ease;
        }
        
        .pwa-install-prompt.show {
            transform: translateY(0);
        }

        /* ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼å¯¾å¿œ */
        .swipe-container {
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        
        .swipe-item {
            scroll-snap-align: start;
            flex-shrink: 0;
        }

        /* é€šçŸ¥ãƒãƒƒã‚¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .notification-badge {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
        @media (prefers-color-scheme: dark) {
            .dark-mode-auto {
                background-color: #1f2937;
                color: #f9fafb;
            }
        }

        /* é«˜DPIå¯¾å¿œ */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .high-dpi-icon {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }

        /* ç¸¦é•·ç”»é¢å¯¾å¿œï¼ˆiPhone Xç³»ï¼‰ */
        @media screen and (max-width: 414px) and (min-height: 812px) {
            .iphone-x-safe {
                padding-bottom: env(safe-area-inset-bottom);
                padding-top: env(safe-area-inset-top);
            }
        }
    </style>
    
    <!-- ä»•æ§˜ã‚¿ã‚°ï¼ˆå…ˆç¥–è¿”ã‚Šé˜²æ­¢ï¼‰ -->
    <!-- spec:c/client/portal#main@v1.0 -->
</head>

<body class="bg-gray-50 font-jp min-h-screen">
    <!-- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="bg-white shadow-sm border-b no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- ãƒ­ã‚´ãƒ»ã‚¿ã‚¤ãƒˆãƒ« -->
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <i class="fas fa-shield-alt text-primary text-2xl mr-3"></i>
                        <h1 class="text-xl font-bold text-gray-900">ã‚¹ãƒãƒ¼ãƒˆãƒãƒªã‚¹</h1>
                    </div>
                    <div class="hidden md:block text-sm text-secondary">
                        å¥‘ç´„ä¼æ¥­å‘ã‘ãƒãƒ¼ã‚¿ãƒ«
                    </div>
                </div>
                
                <!-- å³å´ï¼šç·Šæ€¥é€£çµ¡ãƒ»é€šçŸ¥ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
                <div class="flex items-center space-x-6">
                    <!-- ç·Šæ€¥é€£çµ¡å…ˆ -->
                    <div class="hidden md:flex items-center space-x-2 text-sm">
                        <i class="fas fa-phone text-danger"></i>
                        <span class="text-gray-700">ç·Šæ€¥æ™‚:</span>
                        <span class="font-bold text-danger">24æ™‚é–“ 0120-999-119</span>
                    </div>
                    
                    <!-- ğŸ”” é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ  -->
                    <div class="relative">
                        <button id="notification-toggle" class="text-gray-400 hover:text-gray-500 transition-colors focus-ring rounded relative">
                            <i class="fas fa-bell text-xl notification-bell"></i>
                            <span id="notification-count" class="absolute -top-2 -right-2 bg-danger text-white text-xs rounded-full h-5 w-5 flex items-center justify-center notification-badge">3</span>
                        </button>
                        
                        <!-- é€šçŸ¥ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ‘ãƒãƒ« -->
                        <div id="notification-panel" class="absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border z-50 hidden">
                            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                            <div class="p-4 border-b border-gray-200">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-lg font-semibold text-gray-900">
                                        <i class="fas fa-bell mr-2"></i>é€šçŸ¥
                                    </h3>
                                    <div class="flex items-center space-x-2">
                                        <button id="mark-all-read" class="text-sm text-blue-600 hover:text-blue-800 focus-ring rounded px-2 py-1">
                                            ã™ã¹ã¦æ—¢èª­
                                        </button>
                                        <button id="notification-settings" class="text-gray-400 hover:text-gray-600 focus-ring rounded p-1">
                                            <i class="fas fa-cog"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- é€šçŸ¥ãƒªã‚¹ãƒˆ -->
                            <div class="max-h-96 overflow-y-auto" id="notification-list">
                                <!-- JavaScript ã§å‹•çš„ã«ç”Ÿæˆ -->
                            </div>
                            
                            <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
                            <div class="p-3 border-t border-gray-200 bg-gray-50 rounded-b-lg">
                                <button class="text-sm text-blue-600 hover:text-blue-800 focus-ring rounded w-full text-center py-1">
                                    ã™ã¹ã¦ã®é€šçŸ¥ã‚’è¡¨ç¤º
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
                    <div class="flex items-center space-x-3">
                        <div id="user-avatar" class="bg-primary text-white rounded-full h-9 w-9 flex items-center justify-center">
                            <i class="fas fa-user text-sm"></i>
                        </div>
                        <div class="hidden md:block">
                            <div id="user-name" class="text-sm font-medium text-gray-900">ç”°ä¸­å¤ªéƒ</div>
                            <div id="user-role" class="text-xs text-secondary">â—‹â—‹ãƒ›ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ³ã‚°ã‚¹æ ªå¼ä¼šç¤¾</div>
                        </div>
                    </div>
                    
                    <!-- ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ -->
                    <button id="mobile-menu-btn" class="lg:hidden text-gray-500 hover:text-gray-700 p-2 focus-ring rounded">
                        <i class="fas fa-bars text-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå›ºå®šãƒ»å…ˆç¥–è¿”ã‚Šä¸å¯ï¼‰ -->
    <nav class="bg-primary no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="hidden lg:flex space-x-8 py-3">
                <a href="/c/dashboard" class="nav-link text-white border-b-2 border-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded" data-page="dashboard">
                    <i class="fas fa-home mr-2"></i>ãƒ›ãƒ¼ãƒ 
                </a>
                <a href="/c/announcements" class="nav-link text-blue-100 hover:text-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded" data-page="announcements">
                    <i class="fas fa-bullhorn mr-2"></i>ãŠçŸ¥ã‚‰ã›
                </a>
                <a href="/c/messages" class="nav-link text-blue-100 hover:text-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded" data-page="messages">
                    <i class="fas fa-comments mr-2"></i>ç›¸è«‡ãƒ»é€£çµ¡
                </a>
                <a href="/c/services" class="nav-link text-blue-100 hover:text-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded" data-page="services">
                    <i class="fas fa-concierge-bell mr-2"></i>ç”³è«‹ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰
                </a>
                <a href="/c/materials" class="nav-link text-blue-100 hover:text-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded" data-page="materials">
                    <i class="fas fa-folder-open mr-2"></i>è³‡æ–™å®¤
                </a>
                <a href="/c/seminars" class="nav-link text-blue-100 hover:text-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded" data-page="seminars">
                    <i class="fas fa-calendar-alt mr-2"></i>ã‚»ãƒŸãƒŠãƒ¼
                </a>
                <a href="/c/billing" class="nav-link text-blue-100 hover:text-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded" data-page="billing">
                    <i class="fas fa-receipt mr-2"></i>è«‹æ±‚ãƒ»ãŠæ”¯æ‰•ã„
                </a>
                <a href="/c/company" class="nav-link text-blue-100 hover:text-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded" data-page="company">
                    <i class="fas fa-building mr-2"></i>è‡ªç¤¾æƒ…å ±
                </a>
                <a href="/c/users" class="nav-link text-blue-100 hover:text-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded client-admin-only" data-page="users">
                    <i class="fas fa-users mr-2"></i>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
                </a>
                <a href="/c/reports" class="nav-link text-blue-100 hover:text-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded client-admin-only" data-page="reports">
                    <i class="fas fa-chart-line mr-2"></i>ãƒ¬ãƒãƒ¼ãƒˆãƒ»åˆ†æ
                </a>
                <a href="/c/settings" class="nav-link text-blue-100 hover:text-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded" data-page="settings">
                    <i class="fas fa-cog mr-2"></i>è¨­å®š
                </a>
            </div>
        </div>
        
        <!-- ãƒ¢ãƒã‚¤ãƒ«ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div id="mobile-nav" class="lg:hidden hidden bg-blue-700">
            <div class="px-4 py-2 space-y-1">
                <a href="/c/dashboard" class="mobile-nav-link block px-3 py-2 text-white hover:bg-blue-600 rounded-md transition-colors" data-page="dashboard">
                    <i class="fas fa-home mr-3"></i>ãƒ›ãƒ¼ãƒ 
                </a>
                <a href="/c/announcements" class="mobile-nav-link block px-3 py-2 text-blue-100 hover:bg-blue-600 rounded-md transition-colors" data-page="announcements">
                    <i class="fas fa-bullhorn mr-3"></i>ãŠçŸ¥ã‚‰ã›
                </a>
                <a href="/c/messages" class="mobile-nav-link block px-3 py-2 text-blue-100 hover:bg-blue-600 rounded-md transition-colors" data-page="messages">
                    <i class="fas fa-comments mr-3"></i>ç›¸è«‡ãƒ»é€£çµ¡
                </a>
                <a href="/c/services" class="mobile-nav-link block px-3 py-2 text-blue-100 hover:bg-blue-600 rounded-md transition-colors" data-page="services">
                    <i class="fas fa-concierge-bell mr-3"></i>ç”³è«‹ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰
                </a>
                <a href="/c/materials" class="mobile-nav-link block px-3 py-2 text-blue-100 hover:bg-blue-600 rounded-md transition-colors" data-page="materials">
                    <i class="fas fa-folder-open mr-3"></i>è³‡æ–™å®¤
                </a>
                <a href="/c/seminars" class="mobile-nav-link block px-3 py-2 text-blue-100 hover:bg-blue-600 rounded-md transition-colors" data-page="seminars">
                    <i class="fas fa-calendar-alt mr-3"></i>ã‚»ãƒŸãƒŠãƒ¼
                </a>
                <a href="/c/billing" class="mobile-nav-link block px-3 py-2 text-blue-100 hover:bg-blue-600 rounded-md transition-colors" data-page="billing">
                    <i class="fas fa-receipt mr-3"></i>è«‹æ±‚ãƒ»ãŠæ”¯æ‰•ã„
                </a>
                <a href="/c/company" class="mobile-nav-link block px-3 py-2 text-blue-100 hover:bg-blue-600 rounded-md transition-colors" data-page="company">
                    <i class="fas fa-building mr-3"></i>è‡ªç¤¾æƒ…å ±
                </a>
                <a href="/c/users" class="mobile-nav-link block px-3 py-2 text-blue-100 hover:bg-blue-600 rounded-md transition-colors client-admin-only" data-page="users">
                    <i class="fas fa-users mr-3"></i>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
                </a>
                <a href="/c/reports" class="mobile-nav-link block px-3 py-2 text-blue-100 hover:bg-blue-600 rounded-md transition-colors client-admin-only" data-page="reports">
                    <i class="fas fa-chart-line mr-3"></i>ãƒ¬ãƒãƒ¼ãƒˆãƒ»åˆ†æ
                </a>
                <a href="/c/settings" class="mobile-nav-link block px-3 py-2 text-blue-100 hover:bg-blue-600 rounded-md transition-colors" data-page="settings">
                    <i class="fas fa-cog mr-3"></i>è¨­å®š
                </a>
            </div>
        </div>
    </nav>

    <!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ï¼ˆå…¨ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºï¼‰ -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 no-print">
        <nav class="flex items-center text-sm text-secondary" id="breadcrumb" aria-label="ãƒ‘ãƒ³ããšãƒŠãƒ“">
            <a href="/c/dashboard" class="hover:text-primary focus-ring rounded">ãƒ›ãƒ¼ãƒ </a>
        </nav>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
        
        <!-- ãƒ›ãƒ¼ãƒ ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰ãƒšãƒ¼ã‚¸ -->
        <div id="page-dashboard" class="page-content fade-in">
            <!-- spec:c/client/dashboard#main@v1.0 -->
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">ãƒ›ãƒ¼ãƒ </h2>
                <p class="text-secondary">å¥‘ç´„ä¼æ¥­å‘ã‘ãƒãƒ¼ã‚¿ãƒ«ã¸ã‚ˆã†ã“ã</p>
            </div>

            <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚«ãƒ¼ãƒ‰ï¼ˆ2åˆ—/ã‚¹ãƒãƒ›1åˆ—ï¼‰ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- ç¾åœ¨ã®å¯¾å¿œä¸­ -->
                <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-warning">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-exclamation-circle text-warning mr-2"></i>
                            ç¾åœ¨ã®å¯¾å¿œä¸­
                        </h3>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">æœªè§£æ±ºã®ç›¸è«‡</span>
                            <span class="font-bold text-warning text-xl">2ä»¶</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">å‡¦ç†ä¸­ã®ç”³è«‹</span>
                            <span class="font-bold text-info text-xl">1ä»¶</span>
                        </div>
                        <div class="text-xs text-gray-500 pt-2 border-t">
                            æœ€çµ‚æ›´æ–°: 2024å¹´8æœˆ28æ—¥ 15:30
                        </div>
                    </div>
                    <div class="mt-4">
                        <a href="/c/messages" class="inline-block bg-primary text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700 transition-colors focus-ring">
                            è©³ç´°ã‚’ç¢ºèªã™ã‚‹
                        </a>
                    </div>
                </div>

                <!-- æœ€æ–°ã®ãŠçŸ¥ã‚‰ã› -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-bullhorn text-info mr-2"></i>
                            æœ€æ–°ã®ãŠçŸ¥ã‚‰ã›
                        </h3>
                        <a href="/c/announcements" class="text-sm text-primary hover:text-blue-700 focus-ring rounded">ã™ã¹ã¦è¦‹ã‚‹</a>
                    </div>
                    <div class="space-y-3">
                        <div class="border-l-3 border-danger pl-3">
                            <h4 class="font-medium text-sm text-gray-900">ç·Šæ€¥ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ãŠçŸ¥ã‚‰ã›</h4>
                            <p class="text-xs text-gray-600">2024/08/30 2:00-6:00ã«ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹...</p>
                            <span class="text-xs text-danger">é‡è¦</span>
                        </div>
                        <div class="border-l-3 border-info pl-3">
                            <h4 class="font-medium text-sm text-gray-900">æ–°æ©Ÿèƒ½ãƒªãƒªãƒ¼ã‚¹ã®ã”æ¡ˆå†…</h4>
                            <p class="text-xs text-gray-600">è³‡æ–™å®¤ã«æ¤œç´¢æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ...</p>
                            <span class="text-xs text-info">ãŠçŸ¥ã‚‰ã›</span>
                        </div>
                        <div class="border-l-3 border-success pl-3">
                            <h4 class="font-medium text-sm text-gray-900">ã‚»ãƒŸãƒŠãƒ¼é–‹å‚¬æ±ºå®š</h4>
                            <p class="text-xs text-gray-600">9æœˆåº¦ã®ãƒªã‚¹ã‚¯ç®¡ç†ã‚»ãƒŸãƒŠãƒ¼ã‚’é–‹å‚¬ã—ã¾ã™...</p>
                            <span class="text-xs text-success">ã‚¤ãƒ™ãƒ³ãƒˆ</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- ã‚ˆãä½¿ã†æ“ä½œ -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-star text-warning mr-2"></i>
                        ã‚ˆãä½¿ã†æ“ä½œ
                    </h3>
                    <div class="grid grid-cols-2 gap-3">
                        <a href="/c/messages/new" class="bg-primary text-white p-3 rounded-lg text-center hover:bg-blue-700 transition-colors focus-ring">
                            <i class="fas fa-edit text-lg mb-2"></i>
                            <div class="text-sm font-medium">ç›¸è«‡ã‚’æŠ•ç¨¿ã™ã‚‹</div>
                        </a>
                        <a href="/c/services/customer-harassment" class="bg-danger text-white p-3 rounded-lg text-center hover:bg-red-700 transition-colors focus-ring">
                            <i class="fas fa-shield-alt text-lg mb-2"></i>
                            <div class="text-sm font-medium">ã‚«ã‚¹ãƒãƒ©å‡ºå‹•ä¾é ¼</div>
                        </a>
                        <a href="/c/services/security-seal" class="bg-success text-white p-3 rounded-lg text-center hover:bg-green-700 transition-colors focus-ring">
                            <i class="fas fa-certificate text-lg mb-2"></i>
                            <div class="text-sm font-medium">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚·ãƒ¼ãƒ«</div>
                        </a>
                        <a href="/c/materials" class="bg-secondary text-white p-3 rounded-lg text-center hover:bg-gray-600 transition-colors focus-ring">
                            <i class="fas fa-folder-open text-lg mb-2"></i>
                            <div class="text-sm font-medium">è³‡æ–™å®¤ã‚’é–‹ã</div>
                        </a>
                    </div>
                </div>

                <!-- æ¬¡ã®è«‹æ±‚äºˆå®š -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-receipt text-warning mr-2"></i>
                        æ¬¡ã®è«‹æ±‚äºˆå®š
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">ä»Šæœˆã®æœˆé¡æ–™é‡‘</span>
                            <span class="font-bold text-lg">Â¥50,000</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ–™é‡‘</span>
                            <span class="font-bold text-lg">Â¥12,000</span>
                        </div>
                        <div class="border-t pt-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-900">åˆè¨ˆï¼ˆç¨è¾¼ï¼‰</span>
                                <span class="font-bold text-xl text-primary">Â¥68,200</span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">
                                æ”¯æ‰•æœŸé™: 2024å¹´9æœˆ30æ—¥
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <a href="/c/billing" class="inline-block bg-primary text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700 transition-colors focus-ring">
                            è«‹æ±‚è©³ç´°ã‚’ç¢ºèª
                        </a>
                    </div>
                </div>
            </div>

            <!-- ã‚»ãƒŸãƒŠãƒ¼é–‹å‚¬äºˆå®š -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-calendar-alt text-info mr-2"></i>
                        ã‚»ãƒŸãƒŠãƒ¼é–‹å‚¬äºˆå®š
                    </h3>
                    <a href="/c/seminars" class="text-sm text-primary hover:text-blue-700 focus-ring rounded">ã™ã¹ã¦è¦‹ã‚‹</a>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                        <h4 class="font-medium text-sm text-gray-900 mb-2">ãƒªã‚¹ã‚¯ç®¡ç†åŸºç¤è¬›åº§</h4>
                        <p class="text-xs text-gray-600 mb-2">
                            <i class="fas fa-calendar mr-1"></i>9æœˆ15æ—¥ 14:00-17:00<br>
                            <i class="fas fa-map-marker-alt mr-1"></i>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³é–‹å‚¬
                        </p>
                        <button class="w-full bg-success text-white py-2 px-3 rounded text-xs hover:bg-green-700 transition-colors focus-ring">
                            ç”³è¾¼ã¿
                        </button>
                    </div>
                    <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                        <h4 class="font-medium text-sm text-gray-900 mb-2">ã‚«ã‚¹ãƒãƒ©å¯¾ç­–å®Ÿè·µ</h4>
                        <p class="text-xs text-gray-600 mb-2">
                            <i class="fas fa-calendar mr-1"></i>9æœˆ22æ—¥ 13:00-16:00<br>
                            <i class="fas fa-map-marker-alt mr-1"></i>æ±äº¬ä¼šå ´
                        </p>
                        <button class="w-full bg-success text-white py-2 px-3 rounded text-xs hover:bg-green-700 transition-colors focus-ring">
                            ç”³è¾¼ã¿
                        </button>
                    </div>
                    <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                        <h4 class="font-medium text-sm text-gray-900 mb-2">æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–</h4>
                        <p class="text-xs text-gray-600 mb-2">
                            <i class="fas fa-calendar mr-1"></i>10æœˆ5æ—¥ 10:00-12:00<br>
                            <i class="fas fa-map-marker-alt mr-1"></i>å¤§é˜ªä¼šå ´
                        </p>
                        <button class="w-full bg-success text-white py-2 px-3 rounded text-xs hover:bg-green-700 transition-colors focus-ring">
                            ç”³è¾¼ã¿
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä»–ã®ãƒšãƒ¼ã‚¸ã¯å¾Œã§è¿½åŠ  -->
        <div id="page-announcements" class="page-content hidden fade-in">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">ãŠçŸ¥ã‚‰ã›</h2>
            <p class="text-gray-600">ãŠçŸ¥ã‚‰ã›ãƒšãƒ¼ã‚¸ã®å†…å®¹ï¼ˆå®Ÿè£…äºˆå®šï¼‰</p>
        </div>

        <div id="page-messages" class="page-content hidden fade-in">
            <!-- spec:c/client/messages#main@v1.0 -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">ç›¸è«‡ãƒ»é€£çµ¡</h2>
                    <p class="text-secondary">ãŠå›°ã‚Šã”ã¨ã®ç›¸è«‡ã‚„è³ªå•ã€å ±å‘Šãªã©ã«ã”åˆ©ç”¨ãã ã•ã„</p>
                </div>
                <button id="new-message-btn" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors focus-ring">
                    <i class="fas fa-edit mr-2"></i>
                    æ–°è¦ç›¸è«‡
                </button>
            </div>

            <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢ -->
            <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">çŠ¶æ…‹</label>
                        <select id="status-filter" class="w-full border-gray-300 rounded-md focus-ring">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="received">å—ä»˜ä¸­</option>
                            <option value="in-progress">å¯¾å¿œä¸­</option>
                            <option value="completed">å®Œäº†</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å„ªå…ˆåº¦</label>
                        <select id="priority-filter" class="w-full border-gray-300 rounded-md focus-ring">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="high">é«˜</option>
                            <option value="medium">ä¸­</option>
                            <option value="low">ä½</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æœŸé–“</label>
                        <select id="date-filter" class="w-full border-gray-300 rounded-md focus-ring">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="today">ä»Šæ—¥</option>
                            <option value="week">1é€±é–“</option>
                            <option value="month">1ãƒ¶æœˆ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ¤œç´¢</label>
                        <input type="text" id="search-messages" placeholder="ä»¶åãƒ»å†…å®¹ã§æ¤œç´¢" class="w-full border-gray-300 rounded-md focus-ring">
                    </div>
                </div>
            </div>

            <!-- ç›¸è«‡ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ä»¶å</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å„ªå…ˆåº¦</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ…‹</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ‹…å½“</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ›´æ–°æ—¥</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="messages-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ -->
                            <tr class="hover:bg-gray-50 cursor-pointer" onclick="showMessageDetail(1)">
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        <i class="fas fa-paperclip text-gray-400 mr-2"></i>
                                        <div>
                                            <div class="text-sm font-medium text-gray-900">é¡§å®¢ã‹ã‚‰ã®è‹¦æƒ…å¯¾å¿œã«ã¤ã„ã¦</div>
                                            <div class="text-sm text-gray-500">é¡§å®¢ã‹ã‚‰å•†å“ã«å¯¾ã™ã‚‹è‹¦æƒ…ãŒå¯„ã›ã‚‰ã‚Œã¾ã—ãŸã€‚å¯¾å¿œæ–¹æ³•ã‚’ã”ç›¸è«‡ã•ã›ã¦ãã ã•ã„...</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        <i class="fas fa-exclamation-circle mr-1"></i>é«˜
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                        å¯¾å¿œä¸­
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="text-sm text-gray-900">å±±ç”°ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ</div>
                                    <div class="text-sm text-gray-500">ãƒªã‚¹ã‚¯ç®¡ç†éƒ¨</div>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-500">
                                    2024/08/28<br>
                                    <span class="text-xs">15:30</span>
                                </td>
                                <td class="px-6 py-4 text-sm font-medium">
                                    <button class="text-primary hover:text-blue-700 focus-ring rounded mr-3" onclick="event.stopPropagation(); showMessageDetail(1)">
                                        <i class="fas fa-eye mr-1"></i>è©³ç´°
                                    </button>
                                    <button class="text-success hover:text-green-700 focus-ring rounded" onclick="event.stopPropagation(); replyMessage(1)">
                                        <i class="fas fa-reply mr-1"></i>è¿”ä¿¡
                                    </button>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50 cursor-pointer" onclick="showMessageDetail(2)">
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        <div>
                                            <div class="text-sm font-medium text-gray-900">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®ã®ä»¶</div>
                                            <div class="text-sm text-gray-500">æ¥æœˆäºˆå®šã—ã¦ã„ã‚‹ç¤¾å“¡å‘ã‘ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®ã«ã¤ã„ã¦ã€è¬›å¸«ã®æ‰‹é…ã‚’ãŠé¡˜ã„ã—ã¾ã™...</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                        <i class="fas fa-minus-circle mr-1"></i>ä¸­
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        å®Œäº†
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="text-sm text-gray-900">ä½è—¤ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</div>
                                    <div class="text-sm text-gray-500">æ•™è‚²ç ”ä¿®éƒ¨</div>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-500">
                                    2024/08/27<br>
                                    <span class="text-xs">14:20</span>
                                </td>
                                <td class="px-6 py-4 text-sm font-medium">
                                    <button class="text-primary hover:text-blue-700 focus-ring rounded mr-3" onclick="event.stopPropagation(); showMessageDetail(2)">
                                        <i class="fas fa-eye mr-1"></i>è©³ç´°
                                    </button>
                                    <button class="text-secondary hover:text-gray-600 focus-ring rounded" onclick="event.stopPropagation(); archiveMessage(2)">
                                        <i class="fas fa-archive mr-1"></i>ä¿ç®¡
                                    </button>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50 cursor-pointer" onclick="showMessageDetail(3)">
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        <i class="fas fa-paperclip text-gray-400 mr-2"></i>
                                        <div>
                                            <div class="text-sm font-medium text-gray-900">æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆã®ç¢ºèª</div>
                                            <div class="text-sm text-gray-500">8æœˆåˆ†ã®æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’æ·»ä»˜ã—ã¾ã—ãŸã€‚å†…å®¹ã‚’ã”ç¢ºèªãã ã•ã„...</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                        <i class="fas fa-circle mr-1"></i>ä½
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                        å—ä»˜ä¸­
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="text-sm text-gray-900">æœªå‰²å½“</div>
                                    <div class="text-sm text-gray-500">-</div>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-500">
                                    2024/08/26<br>
                                    <span class="text-xs">09:15</span>
                                </td>
                                <td class="px-6 py-4 text-sm font-medium">
                                    <button class="text-primary hover:text-blue-700 focus-ring rounded mr-3" onclick="event.stopPropagation(); showMessageDetail(3)">
                                        <i class="fas fa-eye mr-1"></i>è©³ç´°
                                    </button>
                                    <button class="text-success hover:text-green-700 focus-ring rounded" onclick="event.stopPropagation(); replyMessage(3)">
                                        <i class="fas fa-reply mr-1"></i>è¿”ä¿¡
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
                <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200">
                    <div class="flex-1 flex justify-between sm:hidden">
                        <button class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus-ring">
                            å‰ã¸
                        </button>
                        <button class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus-ring">
                            æ¬¡ã¸
                        </button>
                    </div>
                    <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                        <div>
                            <p class="text-sm text-gray-700">
                                <span class="font-medium">1</span>-<span class="font-medium">3</span> ä»¶ä¸­ <span class="font-medium">3</span> ä»¶ã‚’è¡¨ç¤º
                            </p>
                        </div>
                        <div>
                            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
                                <button class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus-ring">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="bg-primary border-primary text-white relative inline-flex items-center px-4 py-2 border text-sm font-medium focus-ring">
                                    1
                                </button>
                                <button class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium focus-ring">
                                    2
                                </button>
                                <button class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus-ring">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ–°è¦ç›¸è«‡ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆåˆæœŸã¯éè¡¨ç¤ºï¼‰ -->
            <div id="new-message-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
                <div class="relative top-20 mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-gray-900">æ–°è¦ç›¸è«‡</h3>
                            <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 transition-colors focus-ring rounded">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <!-- æ–°è¦ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ  -->
                        <form id="new-message-form" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- ä»¶å -->
                                <div class="md:col-span-2">
                                    <label for="message-subject" class="block text-sm font-medium text-gray-700 mb-2">
                                        ä»¶å <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" id="message-subject" name="subject" required 
                                           class="w-full border-gray-300 rounded-md focus-ring" 
                                           placeholder="ç›¸è«‡å†…å®¹ã®ä»¶åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                                </div>

                                <!-- å„ªå…ˆåº¦ -->
                                <div>
                                    <label for="message-priority" class="block text-sm font-medium text-gray-700 mb-2">
                                        å„ªå…ˆåº¦ <span class="text-danger">*</span>
                                    </label>
                                    <select id="message-priority" name="priority" required class="w-full border-gray-300 rounded-md focus-ring">
                                        <option value="">å„ªå…ˆåº¦ã‚’é¸æŠ</option>
                                        <option value="high">é«˜ï¼ˆç·Šæ€¥å¯¾å¿œå¿…è¦ï¼‰</option>
                                        <option value="medium">ä¸­ï¼ˆé€šå¸¸å¯¾å¿œï¼‰</option>
                                        <option value="low">ä½ï¼ˆå‚è€ƒãƒ»å ±å‘Šï¼‰</option>
                                    </select>
                                </div>

                                <!-- ã‚«ãƒ†ã‚´ãƒª -->
                                <div>
                                    <label for="message-category" class="block text-sm font-medium text-gray-700 mb-2">
                                        ã‚«ãƒ†ã‚´ãƒª <span class="text-danger">*</span>
                                    </label>
                                    <select id="message-category" name="category" required class="w-full border-gray-300 rounded-md focus-ring">
                                        <option value="">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ</option>
                                        <option value="customer-harassment">ã‚«ã‚¹ãƒãƒ©ãƒ»è¿·æƒ‘è¡Œç‚º</option>
                                        <option value="security-incident">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ</option>
                                        <option value="consultation">ä¸€èˆ¬çš„ãªç›¸è«‡</option>
                                        <option value="training-request">ç ”ä¿®ãƒ»æŒ‡å°ä¾é ¼</option>
                                        <option value="document-request">æ›¸é¡ãƒ»è³‡æ–™ã®ä¾é ¼</option>
                                        <option value="system-issue">ã‚·ã‚¹ãƒ†ãƒ é–¢é€£</option>
                                        <option value="billing-inquiry">è«‹æ±‚ãƒ»æ”¯æ‰•é–¢é€£</option>
                                        <option value="other">ãã®ä»–</option>
                                    </select>
                                </div>
                            </div>

                            <!-- ç›¸è«‡å†…å®¹ -->
                            <div>
                                <label for="message-content" class="block text-sm font-medium text-gray-700 mb-2">
                                    ç›¸è«‡å†…å®¹ <span class="text-danger">*</span>
                                </label>
                                <textarea id="message-content" name="content" required rows="8" 
                                          class="w-full border-gray-300 rounded-md focus-ring" 
                                          placeholder="çŠ¶æ³ã®è©³ç´°ã€ç™ºç”Ÿæ—¥æ™‚ã€é–¢ä¿‚è€…ã€æ±‚ã‚ã‚‹å¯¾å¿œãªã©ã‚’å…·ä½“çš„ã«ã”è¨˜å…¥ãã ã•ã„"></textarea>
                            </div>

                            <!-- æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ« -->
                            <div>
                                <label for="message-files" class="block text-sm font-medium text-gray-700 mb-2">
                                    æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
                                </label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                    <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-4"></i>
                                    <div class="text-sm text-gray-600 mb-2">
                                        ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯
                                    </div>
                                    <input type="file" id="message-files" name="files" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx" 
                                           class="hidden">
                                    <button type="button" onclick="document.getElementById('message-files').click()" 
                                            class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus-ring">
                                        <i class="fas fa-paperclip mr-2"></i>
                                        ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
                                    </button>
                                    <div class="text-xs text-gray-500 mt-2">
                                        ç”»åƒã€PDFã€Wordã€Excelï¼ˆæœ€å¤§5MBã€5ãƒ•ã‚¡ã‚¤ãƒ«ã¾ã§ï¼‰
                                    </div>
                                </div>
                                <div id="selected-files" class="mt-3 space-y-2"></div>
                            </div>

                            <!-- é€£çµ¡å…ˆæƒ…å ± -->
                            <div>
                                <h4 class="text-lg font-medium text-gray-900 mb-4">é€£çµ¡å…ˆæƒ…å ±</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="contact-name" class="block text-sm font-medium text-gray-700 mb-2">
                                            æ‹…å½“è€…å <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" id="contact-name" name="contact_name" required 
                                               class="w-full border-gray-300 rounded-md focus-ring" 
                                               placeholder="æ‹…å½“è€…å">
                                    </div>
                                    <div>
                                        <label for="contact-phone" class="block text-sm font-medium text-gray-700 mb-2">
                                            é€£çµ¡å…ˆé›»è©±ç•ªå·
                                        </label>
                                        <input type="tel" id="contact-phone" name="contact_phone" 
                                               class="w-full border-gray-300 rounded-md focus-ring" 
                                               placeholder="090-1234-5678">
                                    </div>
                                </div>
                            </div>

                            <!-- å¸Œæœ›å¯¾å¿œ -->
                            <div>
                                <label for="requested-action" class="block text-sm font-medium text-gray-700 mb-2">
                                    å¸Œæœ›ã™ã‚‹å¯¾å¿œ
                                </label>
                                <textarea id="requested-action" name="requested_action" rows="3" 
                                          class="w-full border-gray-300 rounded-md focus-ring" 
                                          placeholder="å…·ä½“çš„ã«ã©ã®ã‚ˆã†ãªå¯¾å¿œã‚’å¸Œæœ›ã•ã‚Œã‚‹ã‹ã”è¨˜å…¥ãã ã•ã„"></textarea>
                            </div>

                            <!-- ãƒ•ã‚©ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
                            <div class="flex justify-end space-x-4 pt-6 border-t">
                                <button type="button" id="cancel-btn" class="px-6 py-3 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors focus-ring">
                                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                </button>
                                <button type="submit" class="px-6 py-3 bg-primary text-white rounded-md hover:bg-blue-700 transition-colors focus-ring">
                                    <i class="fas fa-paper-plane mr-2"></i>
                                    ç›¸è«‡ã‚’é€ä¿¡
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- è©³ç´°è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆåˆæœŸã¯éè¡¨ç¤ºï¼‰ -->
            <div id="message-detail-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
                <div class="relative top-20 mx-auto p-5 border w-full max-w-5xl shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-gray-900">ç›¸è«‡è©³ç´°</h3>
                            <button id="close-detail-modal-btn" class="text-gray-400 hover:text-gray-600 transition-colors focus-ring rounded">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <!-- è©³ç´°å†…å®¹ï¼ˆå‹•çš„ã«æ›´æ–°ï¼‰ -->
                        <div id="message-detail-content">
                            <!-- JavaScriptã§å‹•çš„ã«å†…å®¹ã‚’æŒ¿å…¥ -->
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="page-services" class="page-content hidden fade-in">
            <!-- spec:c/client/services#main@v1.0 -->
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">ç”³è«‹ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰</h2>
                <p class="text-secondary">å„ç¨®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ç”³è¾¼ã§ãã¾ã™</p>
            </div>

            <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢ -->
            <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ã‚«ãƒ†ã‚´ãƒª</label>
                        <select id="service-category-filter" class="w-full border-gray-300 rounded-md focus-ring">
                            <option value="">ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹</option>
                            <option value="emergency">ç·Šæ€¥å¯¾å¿œ</option>
                            <option value="security">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</option>
                            <option value="training">ç ”ä¿®ãƒ»æ•™è‚²</option>
                            <option value="consulting">ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ç·Šæ€¥åº¦</label>
                        <select id="service-urgency-filter" class="w-full border-gray-300 rounded-md focus-ring">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="immediate">å³æ™‚å¯¾å¿œ</option>
                            <option value="urgent">ç·Šæ€¥ï¼ˆ24æ™‚é–“ä»¥å†…ï¼‰</option>
                            <option value="normal">é€šå¸¸ï¼ˆ3å–¶æ¥­æ—¥ä»¥å†…ï¼‰</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ¤œç´¢</label>
                        <input type="text" id="service-search" placeholder="ã‚µãƒ¼ãƒ“ã‚¹åã§æ¤œç´¢" class="w-full border-gray-300 rounded-md focus-ring">
                    </div>
                </div>
            </div>

            <!-- ã‚µãƒ¼ãƒ“ã‚¹ã‚«ãƒ¼ãƒ‰ä¸€è¦§ï¼ˆ3-4åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ -->
            <div id="services-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6">
                
                <!-- 1. ã‚«ã‚¹ãƒãƒ©å‡ºå‹•ä¾é ¼ -->
                <div class="service-card bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-200" data-category="emergency" data-urgency="immediate">
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-red-100 rounded-lg p-3">
                            <i class="fas fa-shield-alt text-red-600 text-2xl"></i>
                        </div>
                        <span class="bg-red-100 text-red-800 text-xs font-medium px-2 py-1 rounded-full">ç·Šæ€¥å¯¾å¿œ</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">ã‚«ã‚¹ãƒãƒ©å‡ºå‹•ä¾é ¼</h3>
                    <p class="text-gray-600 text-sm mb-4">é¡§å®¢ã‹ã‚‰ã®è¿·æƒ‘è¡Œç‚ºãƒ»ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆã«å¯¾ã™ã‚‹å°‚é–€ã‚¹ã‚¿ãƒƒãƒ•ã®ç·Šæ€¥æ´¾é£</p>
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-clock mr-2 text-gray-400"></i>
                            <span>30åˆ†ä»¥å†…ã«å‡ºå‹•</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-yen-sign mr-2 text-gray-400"></i>
                            <span>åŸºæœ¬æ–™é‡‘: 50,000å††ã€œ</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-phone mr-2 text-gray-400"></i>
                            <span>24æ™‚é–“365æ—¥å¯¾å¿œ</span>
                        </div>
                    </div>
                    <button class="w-full bg-red-600 text-white py-3 px-4 rounded-lg hover:bg-red-700 transition-colors focus-ring" 
                            onclick="openServiceApplication('customer-harassment')">
                        <i class="fas fa-paper-plane mr-2"></i>
                        ç·Šæ€¥ç”³è¾¼
                    </button>
                </div>

                <!-- 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚·ãƒ¼ãƒ« -->
                <div class="service-card bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-200" data-category="security" data-urgency="normal">
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-blue-100 rounded-lg p-3">
                            <i class="fas fa-certificate text-blue-600 text-2xl"></i>
                        </div>
                        <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚·ãƒ¼ãƒ«</h3>
                    <p class="text-gray-600 text-sm mb-4">é˜²çŠ¯ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ã‚„ã‚·ãƒ¼ãƒ«ã§è¦–è¦šçš„ãªæŠ‘æ­¢åŠ¹æœã‚’æä¾›</p>
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-truck mr-2 text-gray-400"></i>
                            <span>3å–¶æ¥­æ—¥ä»¥å†…ç™ºé€</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-yen-sign mr-2 text-gray-400"></i>
                            <span>åŸºæœ¬æ–™é‡‘: 5,000å††ã€œ</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-palette mr-2 text-gray-400"></i>
                            <span>ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³å¯¾å¿œ</span>
                        </div>
                    </div>
                    <button class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors focus-ring" 
                            onclick="openServiceApplication('security-seal')">
                        <i class="fas fa-shopping-cart mr-2"></i>
                        æ³¨æ–‡ã™ã‚‹
                    </button>
                </div>

                <!-- 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿® -->
                <div class="service-card bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-200" data-category="training" data-urgency="normal">
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-green-100 rounded-lg p-3">
                            <i class="fas fa-graduation-cap text-green-600 text-2xl"></i>
                        </div>
                        <span class="bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full">ç ”ä¿®ãƒ»æ•™è‚²</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®</h3>
                    <p class="text-gray-600 text-sm mb-4">å¾“æ¥­å“¡å‘ã‘ã®é˜²çŠ¯ãƒ»ãƒªã‚¹ã‚¯ç®¡ç†ç ”ä¿®ãƒ—ãƒ­ã‚°ãƒ©ãƒ </p>
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-users mr-2 text-gray-400"></i>
                            <span>1å›æœ€å¤§50åã¾ã§</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-yen-sign mr-2 text-gray-400"></i>
                            <span>åŸºæœ¬æ–™é‡‘: 80,000å††ã€œ</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-clock mr-2 text-gray-400"></i>
                            <span>2-3æ™‚é–“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ </span>
                        </div>
                    </div>
                    <button class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors focus-ring" 
                            onclick="openServiceApplication('security-training')">
                        <i class="fas fa-calendar-plus mr-2"></i>
                        ç ”ä¿®äºˆç´„
                    </button>
                </div>

                <!-- 4. ãƒªã‚¹ã‚¯è¨ºæ–­ -->
                <div class="service-card bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-200" data-category="consulting" data-urgency="normal">
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-purple-100 rounded-lg p-3">
                            <i class="fas fa-search text-purple-600 text-2xl"></i>
                        </div>
                        <span class="bg-purple-100 text-purple-800 text-xs font-medium px-2 py-1 rounded-full">ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">ãƒªã‚¹ã‚¯è¨ºæ–­</h3>
                    <p class="text-gray-600 text-sm mb-4">ç¾çŠ¶ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã‚’å°‚é–€å®¶ãŒè©³ç´°ã«åˆ†æãƒ»è¨ºæ–­</p>
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-file-alt mr-2 text-gray-400"></i>
                            <span>è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆä»˜ã</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-yen-sign mr-2 text-gray-400"></i>
                            <span>åŸºæœ¬æ–™é‡‘: 120,000å††ã€œ</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-calendar mr-2 text-gray-400"></i>
                            <span>1é€±é–“ã§å®Œäº†</span>
                        </div>
                    </div>
                    <button class="w-full bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 transition-colors focus-ring" 
                            onclick="openServiceApplication('risk-assessment')">
                        <i class="fas fa-chart-line mr-2"></i>
                        è¨ºæ–­ä¾é ¼
                    </button>
                </div>

                <!-- 5. è­¦å‚™å“¡æ´¾é£ -->
                <div class="service-card bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-200" data-category="emergency" data-urgency="urgent">
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-orange-100 rounded-lg p-3">
                            <i class="fas fa-user-shield text-orange-600 text-2xl"></i>
                        </div>
                        <span class="bg-orange-100 text-orange-800 text-xs font-medium px-2 py-1 rounded-full">ç·Šæ€¥å¯¾å¿œ</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">è­¦å‚™å“¡æ´¾é£</h3>
                    <p class="text-gray-600 text-sm mb-4">ã‚¤ãƒ™ãƒ³ãƒˆã‚„æ–½è¨­ã®è­¦å‚™ã‚’çµŒé¨“è±Šå¯Œãªã‚¹ã‚¿ãƒƒãƒ•ãŒæ‹…å½“</p>
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-clock mr-2 text-gray-400"></i>
                            <span>24æ™‚é–“ä»¥å†…é…ç½®å¯èƒ½</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-yen-sign mr-2 text-gray-400"></i>
                            <span>æ™‚çµ¦: 2,500å††ã€œ</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-medal mr-2 text-gray-400"></i>
                            <span>æœ‰è³‡æ ¼è€…æ´¾é£</span>
                        </div>
                    </div>
                    <button class="w-full bg-orange-600 text-white py-3 px-4 rounded-lg hover:bg-orange-700 transition-colors focus-ring" 
                            onclick="openServiceApplication('security-guard')">
                        <i class="fas fa-user-plus mr-2"></i>
                        æ´¾é£ä¾é ¼
                    </button>
                </div>

                <!-- 6. é˜²çŠ¯ã‚«ãƒ¡ãƒ©è¨­ç½® -->
                <div class="service-card bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-200" data-category="security" data-urgency="normal">
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-gray-100 rounded-lg p-3">
                            <i class="fas fa-video text-gray-600 text-2xl"></i>
                        </div>
                        <span class="bg-gray-100 text-gray-800 text-xs font-medium px-2 py-1 rounded-full">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">é˜²çŠ¯ã‚«ãƒ¡ãƒ©è¨­ç½®</h3>
                    <p class="text-gray-600 text-sm mb-4">æœ€æ–°ã®é˜²çŠ¯ã‚«ãƒ¡ãƒ©ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆãƒ»è¨­ç½®ãƒ»ä¿å®ˆ</p>
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-tools mr-2 text-gray-400"></i>
                            <span>ç¾åœ°èª¿æŸ»ãƒ»è¨­è¨ˆè¾¼ã¿</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-yen-sign mr-2 text-gray-400"></i>
                            <span>åŸºæœ¬æ–™é‡‘: 200,000å††ã€œ</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-headset mr-2 text-gray-400"></i>
                            <span>3å¹´ä¿å®ˆã‚µãƒãƒ¼ãƒˆ</span>
                        </div>
                    </div>
                    <button class="w-full bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors focus-ring" 
                            onclick="openServiceApplication('security-camera')">
                        <i class="fas fa-wrench mr-2"></i>
                        è¨­ç½®ç›¸è«‡
                    </button>
                </div>

                <!-- 7. æ³•çš„æ›¸é¡ä½œæˆ -->
                <div class="service-card bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-200" data-category="consulting" data-urgency="normal">
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-indigo-100 rounded-lg p-3">
                            <i class="fas fa-file-contract text-indigo-600 text-2xl"></i>
                        </div>
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2 py-1 rounded-full">ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">æ³•çš„æ›¸é¡ä½œæˆ</h3>
                    <p class="text-gray-600 text-sm mb-4">å†…å®¹è¨¼æ˜ã‚„è­¦å‘Šæ›¸ãªã©ã€æ³•çš„åŠ¹åŠ›ã®ã‚ã‚‹æ›¸é¡ä½œæˆã‚µãƒãƒ¼ãƒˆ</p>
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-gavel mr-2 text-gray-400"></i>
                            <span>å¼è­·å£«ç›£ä¿®</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-yen-sign mr-2 text-gray-400"></i>
                            <span>åŸºæœ¬æ–™é‡‘: 30,000å††ã€œ</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-clock mr-2 text-gray-400"></i>
                            <span>3å–¶æ¥­æ—¥ä»¥å†…ä½œæˆ</span>
                        </div>
                    </div>
                    <button class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors focus-ring" 
                            onclick="openServiceApplication('legal-document')">
                        <i class="fas fa-pen mr-2"></i>
                        ä½œæˆä¾é ¼
                    </button>
                </div>

                <!-- 8. ç·Šæ€¥ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚° -->
                <div class="service-card bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-200" data-category="emergency" data-urgency="immediate">
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-yellow-100 rounded-lg p-3">
                            <i class="fas fa-phone-alt text-yellow-600 text-2xl"></i>
                        </div>
                        <span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2 py-1 rounded-full">ç·Šæ€¥å¯¾å¿œ</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">ç·Šæ€¥ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°</h3>
                    <p class="text-gray-600 text-sm mb-4">ç·Šæ€¥äº‹æ…‹ç™ºç”Ÿæ™‚ã®å°‚é–€å®¶ã«ã‚ˆã‚‹é›»è©±ãƒ»ç¾åœ°ã§ã®ç·Šæ€¥ç›¸è«‡</p>
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-phone mr-2 text-gray-400"></i>
                            <span>å³åº§ã«é›»è©±å¯¾å¿œ</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-yen-sign mr-2 text-gray-400"></i>
                            <span>åŸºæœ¬æ–™é‡‘: 20,000å††ã€œ</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-clock mr-2 text-gray-400"></i>
                            <span>24æ™‚é–“365æ—¥</span>
                        </div>
                    </div>
                    <button class="w-full bg-yellow-600 text-white py-3 px-4 rounded-lg hover:bg-yellow-700 transition-colors focus-ring" 
                            onclick="openServiceApplication('emergency-consulting')">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        ç·Šæ€¥ç›¸è«‡
                    </button>
                </div>
            </div>

            <!-- ã‚µãƒ¼ãƒ“ã‚¹ç”³è¾¼ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆåˆæœŸã¯éè¡¨ç¤ºï¼‰ -->
            <div id="service-application-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
                <div class="relative top-20 mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="flex justify-between items-center mb-6">
                            <h3 id="service-modal-title" class="text-2xl font-bold text-gray-900">ã‚µãƒ¼ãƒ“ã‚¹ç”³è¾¼</h3>
                            <button id="close-service-modal-btn" class="text-gray-400 hover:text-gray-600 transition-colors focus-ring rounded">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <!-- ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º -->
                        <div class="mb-8">
                            <div class="flex items-center justify-center">
                                <div id="step-indicator" class="flex items-center space-x-4">
                                    <div class="step-item active flex items-center">
                                        <div class="step-circle bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-medium">1</div>
                                        <span class="ml-2 text-sm font-medium text-primary">ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°</span>
                                    </div>
                                    <div class="w-12 h-px bg-gray-300"></div>
                                    <div class="step-item flex items-center">
                                        <div class="step-circle bg-gray-300 text-gray-500 rounded-full w-8 h-8 flex items-center justify-center text-sm font-medium">2</div>
                                        <span class="ml-2 text-sm font-medium text-gray-500">è©³ç´°å…¥åŠ›</span>
                                    </div>
                                    <div class="w-12 h-px bg-gray-300"></div>
                                    <div class="step-item flex items-center">
                                        <div class="step-circle bg-gray-300 text-gray-500 rounded-full w-8 h-8 flex items-center justify-center text-sm font-medium">3</div>
                                        <span class="ml-2 text-sm font-medium text-gray-500">ç¢ºèªãƒ»é€ä¿¡</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ãƒ•ã‚©ãƒ¼ãƒ å†…å®¹ï¼ˆå‹•çš„ã«å¤‰æ›´ï¼‰ -->
                        <div id="service-form-content">
                            <!-- JavaScriptã§å‹•çš„ã«å†…å®¹ã‚’æŒ¿å…¥ -->
                        </div>

                        <!-- ãƒ•ã‚©ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
                        <div class="flex justify-between items-center pt-6 border-t">
                            <button type="button" id="service-prev-btn" class="px-6 py-3 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors focus-ring hidden">
                                <i class="fas fa-chevron-left mr-2"></i>
                                æˆ»ã‚‹
                            </button>
                            <div class="flex space-x-4 ml-auto">
                                <button type="button" id="service-cancel-btn" class="px-6 py-3 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors focus-ring">
                                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                </button>
                                <button type="button" id="service-next-btn" class="px-6 py-3 bg-primary text-white rounded-md hover:bg-blue-700 transition-colors focus-ring">
                                    æ¬¡ã¸
                                    <i class="fas fa-chevron-right ml-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="page-materials" class="page-content hidden fade-in">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">è³‡æ–™å®¤</h2>
            <p class="text-gray-600">è³‡æ–™å®¤ãƒšãƒ¼ã‚¸ã®å†…å®¹ï¼ˆå®Ÿè£…äºˆå®šï¼‰</p>
        </div>

        <div id="page-seminars" class="page-content hidden fade-in">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">ã‚»ãƒŸãƒŠãƒ¼</h2>
            <p class="text-gray-600">ã‚»ãƒŸãƒŠãƒ¼ãƒšãƒ¼ã‚¸ã®å†…å®¹ï¼ˆå®Ÿè£…äºˆå®šï¼‰</p>
        </div>

        <div id="page-billing" class="page-content hidden fade-in">
            <!-- spec:c/client/billing#main@v1.0 -->
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">è«‹æ±‚ãƒ»ãŠæ”¯æ‰•ã„</h2>
                <p class="text-secondary">è«‹æ±‚æ›¸ã®ç¢ºèªãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚„æ”¯æ‰•ã„çŠ¶æ³ã‚’ç®¡ç†ã§ãã¾ã™</p>
            </div>

            <!-- æ”¯æ‰•ã„çŠ¶æ³ã‚µãƒãƒªãƒ¼ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-blue-500">
                    <div class="flex items-center">
                        <i class="fas fa-file-invoice text-blue-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">ä»Šæœˆã®è«‹æ±‚é¡</h3>
                            <p class="text-2xl font-bold text-gray-900">Â¥485,000</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-green-500">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">æ”¯æ‰•ã„æ¸ˆã¿</h3>
                            <p class="text-2xl font-bold text-gray-900">Â¥1,250,000</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-yellow-500">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-yellow-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">æ”¯æ‰•ã„å¾…ã¡</h3>
                            <p class="text-2xl font-bold text-gray-900">Â¥320,000</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-red-500">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-red-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">å»¶æ»ä¸­</h3>
                            <p class="text-2xl font-bold text-gray-900">Â¥0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢ -->
            <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å¹´æœˆ</label>
                        <select id="billing-period-filter" class="w-full border-gray-300 rounded-md focus-ring">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="2024-08">2024å¹´8æœˆ</option>
                            <option value="2024-07">2024å¹´7æœˆ</option>
                            <option value="2024-06">2024å¹´6æœˆ</option>
                            <option value="2024-05">2024å¹´5æœˆ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ”¯æ‰•ã„çŠ¶æ³</label>
                        <select id="billing-status-filter" class="w-full border-gray-300 rounded-md focus-ring">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="paid">æ”¯æ‰•ã„æ¸ˆã¿</option>
                            <option value="pending">æ”¯æ‰•ã„å¾…ã¡</option>
                            <option value="overdue">å»¶æ»ä¸­</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">é‡‘é¡ç¯„å›²</label>
                        <select id="billing-amount-filter" class="w-full border-gray-300 rounded-md focus-ring">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="0-100000">10ä¸‡å††ä»¥ä¸‹</option>
                            <option value="100000-500000">10-50ä¸‡å††</option>
                            <option value="500000+">50ä¸‡å††ä»¥ä¸Š</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ã‚µãƒ¼ãƒ“ã‚¹ç¨®åˆ¥</label>
                        <select id="billing-service-filter" class="w-full border-gray-300 rounded-md focus-ring">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="monthly">æœˆé¡æ–™é‡‘</option>
                            <option value="emergency">ç·Šæ€¥å¯¾å¿œ</option>
                            <option value="training">ç ”ä¿®ãƒ»ã‚³ãƒ³ã‚µãƒ«</option>
                            <option value="equipment">æ©Ÿå™¨ãƒ»è¨­å‚™</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ¤œç´¢</label>
                        <input type="text" id="billing-search" placeholder="è«‹æ±‚æ›¸ç•ªå·ãƒ»æ‘˜è¦ã§æ¤œç´¢" class="w-full border-gray-300 rounded-md focus-ring">
                    </div>
                </div>
                
                <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->
                <div class="mt-4 flex justify-end space-x-3">
                    <button class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors focus-ring">
                        <i class="fas fa-download mr-2"></i>
                        CSVå‡ºåŠ›
                    </button>
                    <button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus-ring">
                        <i class="fas fa-file-pdf mr-2"></i>
                        PDFä¸€æ‹¬å‡ºåŠ›
                    </button>
                </div>
            </div>

            <!-- è«‹æ±‚æ›¸ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">è«‹æ±‚æ›¸ä¸€è¦§</h3>
                </div>
                
                <!-- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º -->
                <div class="overflow-x-auto desktop-table">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è«‹æ±‚æ›¸ç•ªå·</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è«‹æ±‚æ—¥</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ”¯æ‰•æœŸé™</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ã‚µãƒ¼ãƒ“ã‚¹</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é‡‘é¡</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ³</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="billing-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ -->
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <i class="fas fa-file-invoice text-blue-500 mr-3"></i>
                                        <div>
                                            <div class="text-sm font-medium text-gray-900">INV-2024-08-001</div>
                                            <div class="text-sm text-gray-500">æœˆé¡åŸºæœ¬æ–™é‡‘</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    2024å¹´8æœˆ1æ—¥
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    2024å¹´8æœˆ31æ—¥
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                        æœˆé¡ã‚µãƒ¼ãƒ“ã‚¹
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">Â¥150,000</div>
                                    <div class="text-sm text-gray-500">ç¨è¾¼ Â¥165,000</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        <i class="fas fa-check mr-1"></i>æ”¯æ‰•ã„æ¸ˆã¿
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="text-blue-600 hover:text-blue-700 focus-ring rounded" onclick="showBillingDetail(1)">
                                        <i class="fas fa-eye mr-1"></i>è©³ç´°
                                    </button>
                                    <button class="text-green-600 hover:text-green-700 focus-ring rounded" onclick="downloadInvoicePDF(1)">
                                        <i class="fas fa-download mr-1"></i>PDF
                                    </button>
                                </td>
                            </tr>
                            
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <i class="fas fa-file-invoice text-red-500 mr-3"></i>
                                        <div>
                                            <div class="text-sm font-medium text-gray-900">INV-2024-07-015</div>
                                            <div class="text-sm text-gray-500">ç·Šæ€¥å‡ºå‹•æ–™é‡‘</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    2024å¹´7æœˆ25æ—¥
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    2024å¹´8æœˆ25æ—¥
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        ç·Šæ€¥å¯¾å¿œ
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">Â¥320,000</div>
                                    <div class="text-sm text-gray-500">ç¨è¾¼ Â¥352,000</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                        <i class="fas fa-clock mr-1"></i>æ”¯æ‰•ã„å¾…ã¡
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="text-blue-600 hover:text-blue-700 focus-ring rounded" onclick="showBillingDetail(2)">
                                        <i class="fas fa-eye mr-1"></i>è©³ç´°
                                    </button>
                                    <button class="text-green-600 hover:text-green-700 focus-ring rounded" onclick="downloadInvoicePDF(2)">
                                        <i class="fas fa-download mr-1"></i>PDF
                                    </button>
                                    <button class="text-purple-600 hover:text-purple-700 focus-ring rounded" onclick="showPaymentOptions(2)">
                                        <i class="fas fa-credit-card mr-1"></i>æ”¯æ‰•ã„
                                    </button>
                                </td>
                            </tr>

                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <i class="fas fa-file-invoice text-green-500 mr-3"></i>
                                        <div>
                                            <div class="text-sm font-medium text-gray-900">INV-2024-07-008</div>
                                            <div class="text-sm text-gray-500">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    2024å¹´7æœˆ10æ—¥
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    2024å¹´8æœˆ10æ—¥
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        ç ”ä¿®ãƒ»æ•™è‚²
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">Â¥80,000</div>
                                    <div class="text-sm text-gray-500">ç¨è¾¼ Â¥88,000</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        <i class="fas fa-check mr-1"></i>æ”¯æ‰•ã„æ¸ˆã¿
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="text-blue-600 hover:text-blue-700 focus-ring rounded" onclick="showBillingDetail(3)">
                                        <i class="fas fa-eye mr-1"></i>è©³ç´°
                                    </button>
                                    <button class="text-green-600 hover:text-green-700 focus-ring rounded" onclick="downloadInvoicePDF(3)">
                                        <i class="fas fa-download mr-1"></i>PDF
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
                <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200">
                    <div class="flex-1 flex justify-between sm:hidden">
                        <button class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus-ring">
                            å‰ã¸
                        </button>
                        <button class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus-ring">
                            æ¬¡ã¸
                        </button>
                    </div>
                    <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                        <div>
                            <p class="text-sm text-gray-700">
                                <span class="font-medium">1</span>-<span class="font-medium">3</span> ä»¶ä¸­ <span class="font-medium">15</span> ä»¶ã‚’è¡¨ç¤º
                            </p>
                        </div>
                        <div>
                            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
                                <button class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus-ring">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="bg-primary border-primary text-white relative inline-flex items-center px-4 py-2 border text-sm font-medium focus-ring">
                                    1
                                </button>
                                <button class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium focus-ring">
                                    2
                                </button>
                                <button class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 focus-ring">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è«‹æ±‚æ›¸è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
            <div id="billing-detail-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
                <div class="relative top-20 mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-gray-900">è«‹æ±‚æ›¸è©³ç´°</h3>
                            <button id="close-billing-detail-modal-btn" class="text-gray-400 hover:text-gray-600 transition-colors focus-ring rounded">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <!-- è©³ç´°å†…å®¹ï¼ˆå‹•çš„ã«æ›´æ–°ï¼‰ -->
                        <div id="billing-detail-content">
                            <!-- JavaScriptã§å‹•çš„ã«å†…å®¹ã‚’æŒ¿å…¥ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ”¯æ‰•ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« -->
            <div id="payment-options-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
                <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-gray-900">ãŠæ”¯æ‰•ã„æ–¹æ³•é¸æŠ</h3>
                            <button id="close-payment-options-modal-btn" class="text-gray-400 hover:text-gray-600 transition-colors focus-ring rounded">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <!-- æ”¯æ‰•ã„æ–¹æ³•é¸æŠ -->
                        <div class="space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-medium text-blue-900 mb-2">
                                    <i class="fas fa-university mr-2"></i>éŠ€è¡ŒæŒ¯è¾¼
                                </h4>
                                <p class="text-blue-700 text-sm mb-3">æŒ¯è¾¼æ‰‹æ•°æ–™ã¯ãŠå®¢æ§˜è² æ‹…ã¨ãªã‚Šã¾ã™</p>
                                <div class="text-sm text-blue-800">
                                    <div>éŠ€è¡Œå: ã¿ãšã»éŠ€è¡Œ</div>
                                    <div>æ”¯åº—å: æ–°å®¿æ”¯åº— (123)</div>
                                    <div>å£åº§ç¨®åˆ¥: æ™®é€š</div>
                                    <div>å£åº§ç•ªå·: 1234567</div>
                                    <div>å£åº§åç¾©: ã‚«ï¼‰ã‚¹ãƒãƒ¼ãƒˆãƒãƒªã‚¹</div>
                                </div>
                                <button class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus-ring text-sm">
                                    æŒ¯è¾¼æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼
                                </button>
                            </div>

                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-medium text-green-900 mb-2">
                                    <i class="fas fa-credit-card mr-2"></i>ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ
                                </h4>
                                <p class="text-green-700 text-sm mb-3">VISAãƒ»MasterCardãƒ»JCBãƒ»AMEXå¯¾å¿œ</p>
                                <button class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus-ring text-sm">
                                    ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã¸é€²ã‚€
                                </button>
                            </div>

                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="font-medium text-yellow-900 mb-2">
                                    <i class="fas fa-mobile-alt mr-2"></i>é›»å­æ±ºæ¸ˆ
                                </h4>
                                <p class="text-yellow-700 text-sm mb-3">PayPayãƒ»æ¥½å¤©Payå¯¾å¿œ</p>
                                <div class="flex space-x-2">
                                    <button class="px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 focus-ring text-sm">
                                        PayPay
                                    </button>
                                    <button class="px-3 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus-ring text-sm">
                                        æ¥½å¤©Pay
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="page-company" class="page-content hidden fade-in">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">è‡ªç¤¾æƒ…å ±</h2>
            <p class="text-gray-600">è‡ªç¤¾æƒ…å ±ãƒšãƒ¼ã‚¸ã®å†…å®¹ï¼ˆå®Ÿè£…äºˆå®šï¼‰</p>
        </div>

        <div id="page-users" class="page-content hidden fade-in client-admin-only">
            <!-- spec:c/client/users#main@v1.0 -->
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h2>
                <p class="text-secondary">ç¤¾å†…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã¨è¨­å®šã‚’ç®¡ç†ã—ã¾ã™ï¼ˆClientAdminé™å®šï¼‰</p>
            </div>

            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div class="bg-white p-6 rounded-lg shadow-sm mb-6">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                    <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                        <div class="relative">
                            <input 
                                type="text" 
                                id="user-search" 
                                placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ãƒ¡ãƒ¼ãƒ«ã§æ¤œç´¢" 
                                class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full sm:w-64"
                            >
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        
                        <select id="role-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">å…¨ã¦ã®æ¨©é™</option>
                            <option value="ClientAdmin">ç®¡ç†è€…</option>
                            <option value="ClientUser">ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼</option>
                        </select>
                        
                        <select id="status-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">å…¨ã¦ã®çŠ¶æ…‹</option>
                            <option value="active">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</option>
                            <option value="inactive">ç„¡åŠ¹</option>
                        </select>
                    </div>
                    
                    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                    <div class="flex space-x-3">
                        <button 
                            id="refresh-users-btn" 
                            class="inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-gray-700 rounded-lg hover:bg-gray-50 transition-colors focus-ring"
                        >
                            <i class="fas fa-sync-alt mr-2"></i>
                            æ›´æ–°
                        </button>
                        <button 
                            id="add-user-btn" 
                            class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors focus-ring"
                        >
                            <i class="fas fa-user-plus mr-2"></i>
                            æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ 
                        </button>
                    </div>
                </div>
            </div>

            <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-users mr-2"></i>
                        ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
                        <span id="users-count" class="ml-2 text-sm text-gray-500">(0å)</span>
                    </h3>
                </div>
                
                <!-- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º -->
                <div class="overflow-x-auto desktop-table">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    æ¨©é™ãƒ¬ãƒ™ãƒ«
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    çŠ¶æ…‹
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    æ“ä½œ
                                </th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- JavaScript ã§å‹•çš„ã«è¿½åŠ  -->
                        </tbody>
                    </table>
                </div>

                <!-- ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚«ãƒ¼ãƒ‰è¡¨ç¤º -->
                <div class="mobile-card-view space-y-3">
                    <div id="users-cards-container">
                        <!-- JavaScript ã§å‹•çš„ã«è¿½åŠ  -->
                    </div>
                </div>
            </div>

            <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="mt-6 flex justify-between items-center">
                <div class="text-sm text-gray-500">
                    <span id="users-pagination-info">1-10 of 25 users</span>
                </div>
                <div class="flex space-x-2">
                    <button id="users-prev-page" class="px-3 py-2 border border-gray-300 bg-white text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="users-next-page" class="px-3 py-2 border border-gray-300 bg-white text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
            <div id="user-edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900" id="modal-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†</h3>
                        </div>
                        
                        <form id="user-edit-form" class="p-6 space-y-4">
                            <input type="hidden" id="edit-user-id" name="userId">
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    ãƒ¦ãƒ¼ã‚¶ãƒ¼å <span class="text-red-500">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="edit-user-name" 
                                    name="userName"
                                    required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="text-red-500">*</span>
                                </label>
                                <input 
                                    type="email" 
                                    id="edit-user-email" 
                                    name="userEmail"
                                    required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    æ¨©é™ãƒ¬ãƒ™ãƒ« <span class="text-red-500">*</span>
                                </label>
                                <select 
                                    id="edit-user-role" 
                                    name="userRole"
                                    required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    <option value="ClientAdmin">ç®¡ç†è€…ï¼ˆå…¨æ¨©é™ï¼‰</option>
                                    <option value="ClientUser">ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆé–²è¦§ãƒ»ç”³è«‹ã®ã¿ï¼‰</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">çŠ¶æ…‹</label>
                                <select 
                                    id="edit-user-status" 
                                    name="userStatus"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                                    <option value="active">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</option>
                                    <option value="inactive">ç„¡åŠ¹</option>
                                </select>
                            </div>
                        </form>
                        
                        <div class="px-6 py-4 border-t border-gray-200 flex space-x-3">
                            <button 
                                id="save-user-btn" 
                                class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors focus-ring"
                            >
                                <i class="fas fa-save mr-2"></i>ä¿å­˜
                            </button>
                            <button 
                                id="cancel-edit-btn" 
                                class="flex-1 border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors focus-ring"
                            >
                                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="mt-8 bg-white rounded-lg shadow-sm">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-history mr-2"></i>
                        æœ€è¿‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£
                    </h3>
                </div>
                
                <div class="p-6">
                    <div id="activity-log" class="space-y-4">
                        <!-- JavaScript ã§å‹•çš„ã«è¿½åŠ  -->
                    </div>
                    
                    <div class="mt-4 text-center">
                        <button 
                            id="load-more-activity-btn" 
                            class="text-blue-600 hover:text-blue-800 text-sm focus-ring rounded"
                        >
                            ã•ã‚‰ã«èª­ã¿è¾¼ã‚€
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-settings" class="page-content hidden fade-in">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">è¨­å®š</h2>
            <p class="text-gray-600">è¨­å®šãƒšãƒ¼ã‚¸ã®å†…å®¹ï¼ˆå®Ÿè£…äºˆå®šï¼‰</p>
        </div>

        <!-- ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆãƒ»åˆ†æãƒšãƒ¼ã‚¸ -->
        <div id="page-reports" class="page-content hidden fade-in">
            <!-- spec:c/client/reports#main@v1.0 -->
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">ãƒ¬ãƒãƒ¼ãƒˆãƒ»åˆ†æ</h2>
                <p class="text-secondary">ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãçµŒå–¶æ„æ€æ±ºå®šã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™</p>
            </div>

            <!-- ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ« -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-chart-line mr-2"></i>
                        ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                    </h3>
                    <button 
                        id="generate-custom-report-btn" 
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors focus-ring"
                    >
                        <i class="fas fa-plus mr-2"></i>ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ -->
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg border">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                                <i class="fas fa-calendar-alt text-white"></i>
                            </div>
                            <span class="text-xs bg-blue-200 text-blue-800 px-2 py-1 rounded-full">æœˆæ¬¡</span>
                        </div>
                        <h4 class="font-semibold text-gray-900 mb-2">æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</h4>
                        <p class="text-sm text-gray-600 mb-4">è«‹æ±‚ãƒ»ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨çŠ¶æ³ã®æœˆæ¬¡ã¾ã¨ã‚</p>
                        <button 
                            onclick="reportManager.generateReport('monthly')" 
                            class="w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm"
                        >
                            <i class="fas fa-download mr-2"></i>ç”Ÿæˆ
                        </button>
                    </div>

                    <!-- å¹´æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ -->
                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg border">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center">
                                <i class="fas fa-chart-bar text-white"></i>
                            </div>
                            <span class="text-xs bg-green-200 text-green-800 px-2 py-1 rounded-full">å¹´æ¬¡</span>
                        </div>
                        <h4 class="font-semibold text-gray-900 mb-2">å¹´æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</h4>
                        <p class="text-sm text-gray-600 mb-4">å¹´é–“ã®ç·åˆåˆ†æãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ</p>
                        <button 
                            onclick="reportManager.generateReport('yearly')" 
                            class="w-full px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm"
                        >
                            <i class="fas fa-download mr-2"></i>ç”Ÿæˆ
                        </button>
                    </div>

                    <!-- ã‚³ã‚¹ãƒˆåˆ†æ -->
                    <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 p-4 rounded-lg border">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-12 h-12 bg-yellow-600 rounded-lg flex items-center justify-center">
                                <i class="fas fa-yen-sign text-white"></i>
                            </div>
                            <span class="text-xs bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full">åˆ†æ</span>
                        </div>
                        <h4 class="font-semibold text-gray-900 mb-2">ã‚³ã‚¹ãƒˆåˆ†æ</h4>
                        <p class="text-sm text-gray-600 mb-4">ã‚µãƒ¼ãƒ“ã‚¹åˆ¥ãƒ»æœŸé–“åˆ¥ã‚³ã‚¹ãƒˆè©³ç´°</p>
                        <button 
                            onclick="reportManager.generateReport('cost')" 
                            class="w-full px-3 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition-colors text-sm"
                        >
                            <i class="fas fa-download mr-2"></i>ç”Ÿæˆ
                        </button>
                    </div>

                    <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ -->
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg border">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center">
                                <i class="fas fa-tachometer-alt text-white"></i>
                            </div>
                            <span class="text-xs bg-purple-200 text-purple-800 px-2 py-1 rounded-full">KPI</span>
                        </div>
                        <h4 class="font-semibold text-gray-900 mb-2">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h4>
                        <p class="text-sm text-gray-600 mb-4">KPIãƒ»ROIãƒ»æº€è¶³åº¦åˆ†æ</p>
                        <button 
                            onclick="reportManager.generateReport('performance')" 
                            class="w-full px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors text-sm"
                        >
                            <i class="fas fa-download mr-2"></i>ç”Ÿæˆ
                        </button>
                    </div>
                </div>
            </div>

            <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ»ãƒãƒ£ãƒ¼ãƒˆ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- æœˆæ¬¡æ¨ç§»ã‚°ãƒ©ãƒ• -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-line-chart mr-2"></i>
                        æœˆæ¬¡è«‹æ±‚é¡æ¨ç§»
                    </h3>
                    <div class="relative">
                        <canvas id="monthly-chart" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨å‰²åˆ -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-pie-chart mr-2"></i>
                        ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨å‰²åˆ
                    </h3>
                    <div class="relative">
                        <canvas id="service-pie-chart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- KPI ã‚«ãƒ¼ãƒ‰ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-blue-500">
                    <div class="flex items-center">
                        <i class="fas fa-dollar-sign text-blue-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">ä»Šå¹´ã®ç·æ”¯æ‰•é¡</h3>
                            <p class="text-2xl font-bold text-gray-900" id="kpi-total-payment">Â¥2,340,000</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-green-500">
                    <div class="flex items-center">
                        <i class="fas fa-calendar-check text-green-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨å›æ•°</h3>
                            <p class="text-2xl font-bold text-gray-900" id="kpi-service-count">24å›</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-yellow-500">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-yellow-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">å¹³å‡å¯¾å¿œæ™‚é–“</h3>
                            <p class="text-2xl font-bold text-gray-900" id="kpi-response-time">2.4æ™‚é–“</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-purple-500">
                    <div class="flex items-center">
                        <i class="fas fa-smile text-purple-500 text-2xl mr-3"></i>
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">æº€è¶³åº¦ã‚¹ã‚³ã‚¢</h3>
                            <p class="text-2xl font-bold text-gray-900" id="kpi-satisfaction">4.8/5.0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- éå»ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ -->
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-history mr-2"></i>
                        éå»ã®ãƒ¬ãƒãƒ¼ãƒˆ
                    </h3>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ãƒ¬ãƒãƒ¼ãƒˆå</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç¨®é¡</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æœŸé–“</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ä½œæˆæ—¥</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="reports-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- JavaScript ã§å‹•çš„ã«è¿½åŠ  -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </main>

    <!-- ãƒ™ãƒãƒ•ã‚£ãƒƒãƒˆ/ãƒ‡ãƒ¡ãƒªãƒƒãƒˆèª¬æ˜ï¼ˆãƒšãƒ¼ã‚¸ä¸‹éƒ¨ï¼‰ -->
    <div class="bg-blue-50 py-8 mt-12 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h4 class="font-semibold text-success mb-2">
                        <i class="fas fa-check-circle mr-2"></i>è¨˜éŒ²ã®ä¸€å…ƒåŒ–
                    </h4>
                    <p class="text-sm text-gray-600">ç›¸è«‡ãƒ»ç”³è«‹ãƒ»è³‡æ–™ãƒ»è«‹æ±‚ãŒä¸€ã¤ã®å ´æ‰€ã§ç®¡ç†ã§ãã¾ã™</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h4 class="font-semibold text-success mb-2">
                        <i class="fas fa-clock mr-2"></i>åˆå‹•ã®è¿…é€ŸåŒ–
                    </h4>
                    <p class="text-sm text-gray-600">ç·Šæ€¥é€£çµ¡å…ˆãƒ»ç”³è«‹ãƒ»ç›¸è«‡ãŒè¿·ã‚ãšä½¿ãˆã¾ã™</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h4 class="font-semibold text-warning mb-2">
                        <i class="fas fa-info-circle mr-2"></i>æœ€åˆã®å…¥åŠ›ã«æ‰‹é–“
                    </h4>
                    <p class="text-sm text-gray-600">åˆå›ã«è‡ªç¤¾æƒ…å ±ã‚„æ‹…å½“è€…ã®ç™»éŒ²ãŒå¿…è¦ã§ã™ï¼ˆ1å›ã§å®Œäº†ï¼‰</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ç”¨èªã®ã‚„ã•ã—ã„èª¬æ˜ï¼ˆå›ºå®šãƒœãƒƒã‚¯ã‚¹ï¼‰ -->
    <div class="bg-gray-100 py-6 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h4 class="font-semibold text-gray-900 mb-4">
                <i class="fas fa-question-circle mr-2"></i>ç”¨èªèª¬æ˜
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm">
                <div><strong>ãƒªã‚¹ã‚¯ç®¡ç†:</strong> äº‹æ•…ã‚„ãƒˆãƒ©ãƒ–ãƒ«ã‚’æ¸›ã‚‰ã™ãŸã‚ã®æº–å‚™</div>
                <div><strong>å±æ©Ÿç®¡ç†:</strong> å¤§ããªãƒˆãƒ©ãƒ–ãƒ«ãŒèµ·ããŸæ™‚ã®å‹•ãæ–¹</div>
                <div><strong>ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ:</strong> 1ä»¶ã”ã¨ã®å‡ºæ¥äº‹ï¼ˆç›¸è«‡ã‚„äº‹ä»¶ï¼‰</div>
                <div><strong>ç”³è«‹:</strong> ã‚¹ãƒãƒ¼ãƒˆãƒãƒªã‚¹ã«å…¬å¼ã«ä¾é ¼ã™ã‚‹ã“ã¨</div>
                <div><strong>ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–:</strong> å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä¿ç®¡ã™ã‚‹å ´æ‰€</div>
                <div><strong>PDF:</strong> ç´™ã®ã‚ˆã†ã«è¡¨ç¤ºãƒ»å°åˆ·ã§ãã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼</div>
            </div>
        </div>
    </div>

    <!-- ğŸ“± ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ä¸‹éƒ¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="mobile-bottom-nav md:hidden" id="mobile-bottom-nav">
        <div class="mobile-nav-grid">
            <!-- ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“é …ç›®ï¼ˆ4ã¤é¸æŠœï¼‰ -->
            <a href="/c/dashboard" class="mobile-nav-item nav-link" data-page="dashboard">
                <i class="fas fa-home"></i>
                <span>ãƒ›ãƒ¼ãƒ </span>
            </a>
            <a href="/c/messages" class="mobile-nav-item nav-link" data-page="messages">
                <i class="fas fa-comments"></i>
                <span>ç›¸è«‡</span>
            </a>
            <a href="/c/billing" class="mobile-nav-item nav-link" data-page="billing">
                <i class="fas fa-receipt"></i>
                <span>è«‹æ±‚</span>
            </a>
            <button class="mobile-nav-item" id="mobile-menu-toggle">
                <i class="fas fa-ellipsis-h"></i>
                <span>ãã®ä»–</span>
            </button>
        </div>
    </nav>

    <!-- ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" id="mobile-menu-overlay">
        <div class="fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl p-6 transform transition-transform duration-300" id="mobile-menu-sheet">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold text-gray-900">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
                <button class="text-gray-400 hover:text-gray-600" id="mobile-menu-close">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="grid grid-cols-3 gap-4 mb-6">
                <a href="/c/services" class="mobile-nav-item nav-link text-center p-4 border rounded-lg hover:bg-gray-50" data-page="services">
                    <i class="fas fa-concierge-bell text-2xl mb-2"></i>
                    <div class="text-sm font-medium">ç”³è«‹</div>
                </a>
                <a href="/c/announcements" class="mobile-nav-item nav-link text-center p-4 border rounded-lg hover:bg-gray-50" data-page="announcements">
                    <i class="fas fa-bullhorn text-2xl mb-2"></i>
                    <div class="text-sm font-medium">ãŠçŸ¥ã‚‰ã›</div>
                </a>
                <a href="/c/seminars" class="mobile-nav-item nav-link text-center p-4 border rounded-lg hover:bg-gray-50" data-page="seminars">
                    <i class="fas fa-calendar-alt text-2xl mb-2"></i>
                    <div class="text-sm font-medium">ã‚»ãƒŸãƒŠãƒ¼</div>
                </a>
                <a href="/c/materials" class="mobile-nav-item nav-link text-center p-4 border rounded-lg hover:bg-gray-50" data-page="materials">
                    <i class="fas fa-folder-open text-2xl mb-2"></i>
                    <div class="text-sm font-medium">è³‡æ–™å®¤</div>
                </a>
                <a href="/c/users" class="mobile-nav-item nav-link text-center p-4 border rounded-lg hover:bg-gray-50 client-admin-only" data-page="users">
                    <i class="fas fa-users text-2xl mb-2"></i>
                    <div class="text-sm font-medium">ãƒ¦ãƒ¼ã‚¶ãƒ¼</div>
                </a>
                <a href="/c/settings" class="mobile-nav-item nav-link text-center p-4 border rounded-lg hover:bg-gray-50" data-page="settings">
                    <i class="fas fa-cog text-2xl mb-2"></i>
                    <div class="text-sm font-medium">è¨­å®š</div>
                </a>
            </div>
            
            <!-- ç·Šæ€¥é€£çµ¡ -->
            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <div class="flex items-center text-red-700 mb-2">
                    <i class="fas fa-phone-alt mr-2"></i>
                    <span class="font-semibold">ç·Šæ€¥é€£çµ¡</span>
                </div>
                <a href="tel:0120-999-119" class="text-red-600 font-bold text-lg">24æ™‚é–“ 0120-999-119</a>
            </div>
        </div>
    </div>

    <!-- PWA ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ -->
    <div class="pwa-install-prompt" id="pwa-install-prompt">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-mobile-alt text-2xl mr-3"></i>
                <div>
                    <div class="font-semibold">ã‚¢ãƒ—ãƒªã¨ã—ã¦è¿½åŠ </div>
                    <div class="text-sm opacity-80">ã‚ˆã‚Šå¿«é©ã«ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™</div>
                </div>
            </div>
            <div class="flex space-x-2">
                <button class="px-3 py-1 bg-white bg-opacity-20 rounded text-sm" id="pwa-dismiss">å¾Œã§</button>
                <button class="px-3 py-1 bg-white text-gray-900 rounded text-sm font-medium" id="pwa-install">è¿½åŠ </button>
            </div>
        </div>
    </div>

    <!-- ğŸ”” é€šçŸ¥è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="notification-settings-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-lg w-full">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">é€šçŸ¥è¨­å®š</h3>
                </div>
                
                <div class="p-6 space-y-6">
                    <!-- é€šçŸ¥ã‚«ãƒ†ã‚´ãƒªãƒ¼ -->
                    <div>
                        <h4 class="font-medium text-gray-900 mb-4">é€šçŸ¥ã®ç¨®é¡</h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas fa-credit-card text-blue-500 mr-3"></i>
                                    <div>
                                        <div class="font-medium text-gray-900">æ”¯æ‰•ã„é–¢é€£</div>
                                        <div class="text-sm text-gray-500">è«‹æ±‚æ›¸ãƒ»æ”¯æ‰•æœŸé™ãƒ»å»¶æ»é€šçŸ¥</div>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas fa-exclamation-triangle text-yellow-500 mr-3"></i>
                                    <div>
                                        <div class="font-medium text-gray-900">ç·Šæ€¥ãƒ»é‡è¦</div>
                                        <div class="text-sm text-gray-500">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ã‚·ã‚¹ãƒ†ãƒ é‡è¦æ›´æ–°</div>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas fa-info-circle text-green-500 mr-3"></i>
                                    <div>
                                        <div class="font-medium text-gray-900">ä¸€èˆ¬æƒ…å ±</div>
                                        <div class="text-sm text-gray-500">ãŠçŸ¥ã‚‰ã›ãƒ»ã‚»ãƒŸãƒŠãƒ¼ãƒ»æ–°æ©Ÿèƒ½</div>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚° -->
                    <div>
                        <h4 class="font-medium text-gray-900 mb-4">æ”¯æ‰•æœŸé™ã®é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°</h4>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-3" checked>
                                <span class="text-gray-700">14æ—¥å‰</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-3" checked>
                                <span class="text-gray-700">7æ—¥å‰</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-3" checked>
                                <span class="text-gray-700">3æ—¥å‰</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-3" checked>
                                <span class="text-gray-700">å½“æ—¥</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-3" checked>
                                <span class="text-gray-700">å»¶æ»æ™‚</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- é€šçŸ¥æ–¹æ³• -->
                    <div>
                        <h4 class="font-medium text-gray-900 mb-4">é€šçŸ¥æ–¹æ³•</h4>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-3" checked>
                                <span class="text-gray-700">ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-3">
                                <span class="text-gray-700">ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼ˆå®Ÿè£…äºˆå®šï¼‰</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button id="cancel-notification-settings" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors focus-ring">
                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                    </button>
                    <button id="save-notification-settings" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors focus-ring">
                        ä¿å­˜
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸš¨ é€šçŸ¥ãƒˆãƒ¼ã‚¹ãƒˆï¼ˆå³ä¸Šè¡¨ç¤ºï¼‰ -->
    <div id="notification-toast-container" class="fixed top-4 right-4 space-y-2 z-50">
        <!-- JavaScript ã§å‹•çš„ã«è¿½åŠ  -->
    </div>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="bg-gray-800 text-white py-8 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h5 class="font-semibold mb-3">ãŠå›°ã‚Šã®æ™‚ã¯</h5>
                    <p class="text-sm text-gray-300 mb-2">ã¾ãšç›¸è«‡ã‚’æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚</p>
                    <p class="text-sm text-gray-300">ç·Šæ€¥ã®å ´åˆã¯é›»è©±é€£çµ¡ã‚‚åˆã‚ã›ã¦è¡Œã£ã¦ãã ã•ã„ã€‚</p>
                </div>
                <div>
                    <h5 class="font-semibold mb-3">å•ã„åˆã‚ã›çª“å£</h5>
                    <p class="text-sm text-gray-300">å¹³æ—¥ 9:00-18:00</p>
                    <p class="text-sm text-gray-300">03-1234-5678</p>
                </div>
                <div>
                    <h5 class="font-semibold mb-3">ãƒãƒªã‚·ãƒ¼</h5>
                    <ul class="text-sm text-gray-300 space-y-1">
                        <li><a href="#" class="hover:text-white focus-ring rounded">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a></li>
                        <li><a href="#" class="hover:text-white focus-ring rounded">åˆ©ç”¨è¦ç´„</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="font-semibold mb-3">ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h5>
                    <p class="text-sm text-gray-300">ãƒãƒ¼ã‚¸ãƒ§ãƒ³: v1.0.0</p>
                    <p class="text-sm text-gray-300">æ›´æ–°æ—¥: 2024-08-28</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // ãƒšãƒ¼ã‚¸ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡
        class ClientPortal {
            constructor() {
                this.currentPage = 'dashboard';
                this.userRole = 'ClientAdmin'; // ClientAdmin or ClientUser
                this.init();
            }

            init() {
                this.setupNavigation();
                this.setupMobileMenu();
                this.setupEnhancedMobile();
                this.setupPWA();
                this.setupUserRole();
                this.showPage('dashboard');
                
                console.log('ã‚¹ãƒãƒ¼ãƒˆãƒãƒªã‚¹ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒãƒ¼ã‚¿ãƒ« v1.0 åˆæœŸåŒ–å®Œäº†');
            }

            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
            setupNavigation() {
                const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
                
                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = link.dataset.page;
                        this.showPage(page);
                    });
                });
            }

            // ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¨­å®š
            setupMobileMenu() {
                const mobileMenuBtn = document.getElementById('mobile-menu-btn');
                const mobileNav = document.getElementById('mobile-nav');
                
                if (mobileMenuBtn && mobileNav) {
                    mobileMenuBtn.addEventListener('click', () => {
                        mobileNav.classList.toggle('hidden');
                    });
                }
            }

            // ğŸ“± å¼·åŒ–ã•ã‚ŒãŸãƒ¢ãƒã‚¤ãƒ«æ©Ÿèƒ½è¨­å®š
            setupEnhancedMobile() {
                // ãƒ¢ãƒã‚¤ãƒ«ä¸‹éƒ¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
                this.setupBottomNavigation();
                
                // ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
                this.setupMobileMenuOverlay();
                
                // ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼
                this.setupSwipeGestures();
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–
                this.optimizeModalsForMobile();
            }

            // ä¸‹éƒ¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            setupBottomNavigation() {
                const bottomNavLinks = document.querySelectorAll('.mobile-nav-item[data-page]');
                bottomNavLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = link.dataset.page;
                        this.showPage(page);
                        this.updateBottomNavActive(page);
                    });
                });
            }

            // ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
            setupMobileMenuOverlay() {
                const menuToggle = document.getElementById('mobile-menu-toggle');
                const menuOverlay = document.getElementById('mobile-menu-overlay');
                const menuClose = document.getElementById('mobile-menu-close');

                if (menuToggle && menuOverlay) {
                    menuToggle.addEventListener('click', () => {
                        menuOverlay.classList.remove('hidden');
                        document.body.style.overflow = 'hidden';
                    });
                }

                if (menuClose && menuOverlay) {
                    menuClose.addEventListener('click', () => {
                        menuOverlay.classList.add('hidden');
                        document.body.style.overflow = 'auto';
                    });
                }

                // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
                if (menuOverlay) {
                    menuOverlay.addEventListener('click', (e) => {
                        if (e.target === menuOverlay) {
                            menuOverlay.classList.add('hidden');
                            document.body.style.overflow = 'auto';
                        }
                    });
                }
            }

            // ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼
            setupSwipeGestures() {
                let startX = 0;
                let startY = 0;

                document.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                });

                document.addEventListener('touchend', (e) => {
                    if (!startX || !startY) return;

                    const endX = e.changedTouches[0].clientX;
                    const endY = e.changedTouches[0].clientY;
                    const diffX = startX - endX;
                    const diffY = startY - endY;

                    // æ°´å¹³ã‚¹ãƒ¯ã‚¤ãƒ—ãŒå‚ç›´ã‚¹ãƒ¯ã‚¤ãƒ—ã‚ˆã‚Šå¤§ãã„å ´åˆ
                    if (Math.abs(diffX) > Math.abs(diffY)) {
                        if (Math.abs(diffX) > 50) { // 50pxä»¥ä¸Šã®ã‚¹ãƒ¯ã‚¤ãƒ—
                            if (diffX > 0) {
                                // å·¦ã‚¹ãƒ¯ã‚¤ãƒ— - æ¬¡ã®ãƒšãƒ¼ã‚¸
                                this.swipeToNextPage();
                            } else {
                                // å³ã‚¹ãƒ¯ã‚¤ãƒ— - å‰ã®ãƒšãƒ¼ã‚¸
                                this.swipeToPrevPage();
                            }
                        }
                    }

                    startX = 0;
                    startY = 0;
                });
            }

            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–
            optimizeModalsForMobile() {
                const modals = document.querySelectorAll('[id$="-modal"]');
                modals.forEach(modal => {
                    if (window.innerWidth <= 480) {
                        const modalContent = modal.querySelector('.max-w-md, .max-w-lg, .max-w-xl');
                        if (modalContent) {
                            modalContent.classList.add('modal-mobile-full');
                        }
                    }
                });
            }

            // PWAè¨­å®š
            setupPWA() {
                // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯¾å¿œ
                let deferredPrompt;
                const installPrompt = document.getElementById('pwa-install-prompt');
                const installBtn = document.getElementById('pwa-install');
                const dismissBtn = document.getElementById('pwa-dismiss');

                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    
                    // ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã¿è¡¨ç¤º
                    if (window.innerWidth <= 768) {
                        setTimeout(() => {
                            installPrompt?.classList.add('show');
                        }, 3000); // 3ç§’å¾Œã«è¡¨ç¤º
                    }
                });

                installBtn?.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`PWA install ${outcome}`);
                        deferredPrompt = null;
                    }
                    installPrompt?.classList.remove('show');
                });

                dismissBtn?.addEventListener('click', () => {
                    installPrompt?.classList.remove('show');
                });
            }

            // ä¸‹éƒ¨ãƒŠãƒ“ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹æ›´æ–°
            updateBottomNavActive(pageId) {
                const bottomNavItems = document.querySelectorAll('.mobile-nav-item[data-page]');
                bottomNavItems.forEach(item => {
                    if (item.dataset.page === pageId) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
            }

            // ã‚¹ãƒ¯ã‚¤ãƒ—ã§ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ
            swipeToNextPage() {
                const pages = ['dashboard', 'messages', 'billing', 'services'];
                const currentIndex = pages.indexOf(this.currentPage);
                if (currentIndex < pages.length - 1) {
                    this.showPage(pages[currentIndex + 1]);
                }
            }

            swipeToPrevPage() {
                const pages = ['dashboard', 'messages', 'billing', 'services'];
                const currentIndex = pages.indexOf(this.currentPage);
                if (currentIndex > 0) {
                    this.showPage(pages[currentIndex - 1]);
                }
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™è¨­å®š
            setupUserRole() {
                const adminOnlyElements = document.querySelectorAll('.client-admin-only');
                
                if (this.userRole !== 'ClientAdmin') {
                    adminOnlyElements.forEach(element => {
                        element.style.display = 'none';
                    });
                }
            }

            // ãƒšãƒ¼ã‚¸è¡¨ç¤º
            showPage(pageId) {
                // ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã‚’éè¡¨ç¤º
                const allPages = document.querySelectorAll('.page-content');
                allPages.forEach(page => {
                    page.classList.add('hidden');
                });

                // æŒ‡å®šãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
                const targetPage = document.getElementById(`page-${pageId}`);
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                    this.currentPage = pageId;
                    this.updateNavigation(pageId);
                    this.updateBreadcrumb(pageId);
                    window.scrollTo(0, 0);
                }
            }

            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹æ›´æ–°
            updateNavigation(pageId) {
                const allNavLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
                
                allNavLinks.forEach(link => {
                    if (link.dataset.page === pageId) {
                        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹
                        if (link.classList.contains('nav-link')) {
                            link.className = 'nav-link text-white border-b-2 border-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded';
                        } else {
                            link.className = 'mobile-nav-link block px-3 py-2 text-white bg-blue-600 rounded-md transition-colors';
                        }
                    } else {
                        // éã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹
                        if (link.classList.contains('nav-link')) {
                            link.className = 'nav-link text-blue-100 hover:text-white px-2 pb-1 text-sm font-medium whitespace-nowrap transition-colors focus-ring rounded';
                        } else {
                            link.className = 'mobile-nav-link block px-3 py-2 text-blue-100 hover:bg-blue-600 rounded-md transition-colors';
                        }
                    }
                });
            }

            // ãƒ‘ãƒ³ããšæ›´æ–°
            updateBreadcrumb(pageId) {
                const breadcrumb = document.getElementById('breadcrumb');
                const pageNames = {
                    'dashboard': 'ãƒ›ãƒ¼ãƒ ',
                    'announcements': 'ãŠçŸ¥ã‚‰ã›',
                    'messages': 'ç›¸è«‡ãƒ»é€£çµ¡',
                    'services': 'ç”³è«‹ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰',
                    'materials': 'è³‡æ–™å®¤',
                    'seminars': 'ã‚»ãƒŸãƒŠãƒ¼',
                    'billing': 'è«‹æ±‚ãƒ»ãŠæ”¯æ‰•ã„',
                    'company': 'è‡ªç¤¾æƒ…å ±',
                    'users': 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†',
                    'settings': 'è¨­å®š'
                };

                if (pageId === 'dashboard') {
                    breadcrumb.innerHTML = '<a href="/c/dashboard" class="hover:text-primary focus-ring rounded">ãƒ›ãƒ¼ãƒ </a>';
                } else {
                    breadcrumb.innerHTML = `
                        <a href="/c/dashboard" class="hover:text-primary focus-ring rounded">ãƒ›ãƒ¼ãƒ </a>
                        <span class="mx-2">ï¼</span>
                        <span class="text-gray-900">${pageNames[pageId] || pageId}</span>
                    `;
                }
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.clientPortal = new ClientPortal();
            window.messagesManager = new MessagesManager();
            window.servicesManager = new ServicesManager();
            window.billingManager = new BillingManager();
            window.userManager = new UserManager();
            window.notificationManager = new NotificationManager();
            window.reportManager = new ReportManager();
        });

        // ç›¸è«‡ãƒ»é€£çµ¡ç®¡ç†ã‚¯ãƒ©ã‚¹
        class MessagesManager {
            constructor() {
                this.baseURL = 'http://localhost:3001/api';
                this.messages = [];
                this.setupEventListeners();
                this.loadMessages(); // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            }

            setupEventListeners() {
                // æ–°è¦ç›¸è«‡ãƒœã‚¿ãƒ³
                document.getElementById('new-message-btn')?.addEventListener('click', () => {
                    this.showNewMessageModal();
                });

                // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
                document.getElementById('close-modal-btn')?.addEventListener('click', () => {
                    this.hideNewMessageModal();
                });

                document.getElementById('close-detail-modal-btn')?.addEventListener('click', () => {
                    this.hideDetailModal();
                });

                document.getElementById('cancel-btn')?.addEventListener('click', () => {
                    this.hideNewMessageModal();
                });

                // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
                document.getElementById('new-message-form')?.addEventListener('submit', (e) => {
                    this.handleFormSubmit(e);
                });

                // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
                document.getElementById('message-files')?.addEventListener('change', (e) => {
                    this.handleFileSelection(e);
                });

                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                document.getElementById('status-filter')?.addEventListener('change', () => {
                    this.filterMessages();
                });

                document.getElementById('priority-filter')?.addEventListener('change', () => {
                    this.filterMessages();
                });

                document.getElementById('search-messages')?.addEventListener('input', () => {
                    this.filterMessages();
                });
            }

            showNewMessageModal() {
                document.getElementById('new-message-modal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            hideNewMessageModal() {
                document.getElementById('new-message-modal').classList.add('hidden');
                document.body.style.overflow = 'auto';
                this.resetForm();
            }

            hideDetailModal() {
                document.getElementById('message-detail-modal').classList.add('hidden');
                document.body.style.overflow = 'auto';
            }

            resetForm() {
                document.getElementById('new-message-form').reset();
                document.getElementById('selected-files').innerHTML = '';
            }

            handleFormSubmit(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const messageData = {
                    subject: formData.get('subject'),
                    content: formData.get('content'),
                    priority: formData.get('priority'),
                    category: formData.get('category'),
                    contact_name: formData.get('contact_name'),
                    contact_phone: formData.get('contact_phone'),
                    requested_action: formData.get('requested_action')
                };

                // é€ä¿¡å‡¦ç†ï¼ˆä»®å®Ÿè£…ï¼‰
                this.submitMessage(messageData);
            }

            async submitMessage(messageData) {
                try {
                    // é€ä¿¡ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    const submitBtn = document.querySelector('#new-message-form button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>é€ä¿¡ä¸­...';
                    submitBtn.disabled = true;

                    // å®Ÿéš›ã®APIã«é€ä¿¡
                    const response = await fetch(`${this.baseURL}/messages`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(messageData)
                    });

                    const result = await response.json();

                    if (result.success) {
                        // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                        alert('ç›¸è«‡ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚æ‹…å½“è€…ã‹ã‚‰å›ç­”ã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚');
                        this.hideNewMessageModal();
                        this.refreshMessageList(); // ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                    } else {
                        throw new Error(result.error || 'é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;

                } catch (error) {
                    console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
                    alert('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                    
                    // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
                    const submitBtn = document.querySelector('#new-message-form button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>ç›¸è«‡ã‚’é€ä¿¡';
                    submitBtn.disabled = false;
                }
            }

            handleFileSelection(e) {
                const files = e.target.files;
                const selectedFilesDiv = document.getElementById('selected-files');
                selectedFilesDiv.innerHTML = '';

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const fileItem = document.createElement('div');
                    fileItem.className = 'flex items-center justify-between p-2 bg-gray-50 rounded';
                    fileItem.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-file text-gray-400 mr-2"></i>
                            <span class="text-sm">${file.name}</span>
                            <span class="text-xs text-gray-500 ml-2">(${(file.size / 1024).toFixed(1)}KB)</span>
                        </div>
                        <button type="button" onclick="this.parentElement.remove()" 
                                class="text-red-500 hover:text-red-700 focus-ring rounded">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    selectedFilesDiv.appendChild(fileItem);
                }
            }

            filterMessages() {
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ï¼ˆä»®å®Ÿè£…ï¼‰
                const statusFilter = document.getElementById('status-filter').value;
                const priorityFilter = document.getElementById('priority-filter').value;
                const searchTerm = document.getElementById('search-messages').value.toLowerCase();

                console.log('ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨:', { statusFilter, priorityFilter, searchTerm });
                // å®Ÿéš›ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‡¦ç†ã‚’ã“ã“ã«å®Ÿè£…
            }

            // APIã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            async loadMessages() {
                try {
                    const response = await fetch(`${this.baseURL}/messages`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.messages = data.data;
                        this.updateMessageTable();
                    } else {
                        console.error('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', data.error);
                    }
                } catch (error) {
                    console.error('APIã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°
            updateMessageTable() {
                const tbody = document.getElementById('messages-table-body');
                if (!tbody) return;

                tbody.innerHTML = '';

                this.messages.forEach(message => {
                    const row = this.createMessageRow(message);
                    tbody.appendChild(row);
                });
            }

            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡Œã‚’ä½œæˆ
            createMessageRow(message) {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 cursor-pointer';
                row.onclick = () => this.showMessageDetail(message.id);

                const priorityBadge = this.getPriorityBadge(message.priority);
                const statusBadge = this.getStatusBadge(message.status);
                const hasAttachments = message.attachment_count > 0;

                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            ${hasAttachments ? '<i class="fas fa-paperclip text-gray-400 mr-2"></i>' : ''}
                            <div>
                                <div class="text-sm font-medium text-gray-900">${message.subject}</div>
                                <div class="text-sm text-gray-500">${this.truncateText(message.content, 80)}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">${priorityBadge}</td>
                    <td class="px-6 py-4">${statusBadge}</td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">${message.assignee || 'æœªå‰²å½“'}</div>
                        ${message.department ? `<div class="text-sm text-gray-500">${message.department}</div>` : ''}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-500">
                        ${this.formatDate(message.created_at)}
                    </td>
                    <td class="px-6 py-4 text-sm font-medium">
                        <button class="text-primary hover:text-blue-700 focus-ring rounded mr-3" onclick="event.stopPropagation(); window.messagesManager.showMessageDetail(${message.id})">
                            <i class="fas fa-eye mr-1"></i>è©³ç´°
                        </button>
                        ${message.status !== 'completed' ? `
                        <button class="text-success hover:text-green-700 focus-ring rounded" onclick="event.stopPropagation(); replyMessage(${message.id})">
                            <i class="fas fa-reply mr-1"></i>è¿”ä¿¡
                        </button>
                        ` : `
                        <button class="text-secondary hover:text-gray-600 focus-ring rounded" onclick="event.stopPropagation(); archiveMessage(${message.id})">
                            <i class="fas fa-archive mr-1"></i>ä¿ç®¡
                        </button>
                        `}
                    </td>
                `;

                return row;
            }

            // å„ªå…ˆåº¦ãƒãƒƒã‚¸
            getPriorityBadge(priority) {
                const badges = {
                    'high': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"><i class="fas fa-exclamation-circle mr-1"></i>é«˜</span>',
                    'medium': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"><i class="fas fa-minus-circle mr-1"></i>ä¸­</span>',
                    'low': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"><i class="fas fa-circle mr-1"></i>ä½</span>'
                };
                return badges[priority] || badges['medium'];
            }

            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
            getStatusBadge(status) {
                const badges = {
                    'received': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">å—ä»˜ä¸­</span>',
                    'in-progress': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">å¯¾å¿œä¸­</span>',
                    'completed': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">å®Œäº†</span>',
                    'archived': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">ä¿ç®¡</span>'
                };
                return badges[status] || badges['received'];
            }

            // ãƒ†ã‚­ã‚¹ãƒˆåˆ‡ã‚Šè©°ã‚
            truncateText(text, length) {
                return text.length > length ? text.substring(0, length) + '...' : text;
            }

            // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            formatDate(dateString) {
                const date = new Date(dateString);
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                
                return `${year}/${month}/${day}<br><span class="text-xs">${hours}:${minutes}</span>`;
            }

            refreshMessageList() {
                // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆæ›´æ–°
                this.loadMessages();
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆHTMLã‹ã‚‰å‘¼ã³å‡ºã—ç”¨ï¼‰
        function showMessageDetail(messageId) {
            if (window.messagesManager) {
                window.messagesManager.showMessageDetail(messageId);
            }
        }

        function replyMessage(messageId) {
            console.log('è¿”ä¿¡:', messageId);
            // è¿”ä¿¡æ©Ÿèƒ½ã®å®Ÿè£…
        }

        function archiveMessage(messageId) {
            if (confirm('ã“ã®ç›¸è«‡ã‚’ä¿ç®¡ã—ã¾ã™ã‹ï¼Ÿ')) {
                console.log('ä¿ç®¡:', messageId);
                // ä¿ç®¡æ©Ÿèƒ½ã®å®Ÿè£…
            }
        }

        // MessagesManagerã‚¯ãƒ©ã‚¹ã«showMessageDetailãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
        MessagesManager.prototype.showMessageDetail = function(messageId) {
            const message = this.messages.find(m => m.id === messageId);
            if (!message) return;

            const modal = document.getElementById('message-detail-modal');
            const content = document.getElementById('message-detail-content');
            
            const statusLabels = {
                'received': 'å—ä»˜ä¸­',
                'in-progress': 'å¯¾å¿œä¸­',
                'completed': 'å®Œäº†'
            };

            const priorityLabels = {
                'high': 'é«˜',
                'medium': 'ä¸­',
                'low': 'ä½'
            };

            const priorityColors = {
                'high': 'bg-red-100 text-red-800',
                'medium': 'bg-yellow-100 text-yellow-800',
                'low': 'bg-gray-100 text-gray-800'
            };

            const statusColors = {
                'received': 'bg-blue-100 text-blue-800',
                'in-progress': 'bg-yellow-100 text-yellow-800',
                'completed': 'bg-green-100 text-green-800'
            };

            content.innerHTML = `
                <div class="space-y-6">
                    <!-- åŸºæœ¬æƒ…å ± -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <h4 class="font-medium text-gray-900 mb-2">ä»¶å</h4>
                                <p class="text-gray-700">${message.subject}</p>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 mb-2">å„ªå…ˆåº¦</h4>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${priorityColors[message.priority]}">
                                    ${priorityLabels[message.priority]}
                                </span>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 mb-2">çŠ¶æ…‹</h4>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColors[message.status]}">
                                    ${statusLabels[message.status]}
                                </span>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 mb-2">ä½œæˆæ—¥æ™‚</h4>
                                <p class="text-gray-700">${new Date(message.created_at).toLocaleString('ja-JP')}</p>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 mb-2">æ‹…å½“è€…</h4>
                                <p class="text-gray-700">${message.assignee || 'æœªå‰²å½“'}</p>
                                ${message.department ? `<p class="text-sm text-gray-500">${message.department}</p>` : ''}
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 mb-2">é€£çµ¡å…ˆ</h4>
                                <p class="text-gray-700">${message.contact_name}</p>
                                ${message.contact_phone ? `<p class="text-sm text-gray-500">${message.contact_phone}</p>` : ''}
                            </div>
                        </div>
                    </div>

                    <!-- ç›¸è«‡å†…å®¹ -->
                    <div>
                        <h4 class="font-medium text-gray-900 mb-4">ç›¸è«‡å†…å®¹</h4>
                        <div class="bg-white border rounded-lg p-6">
                            <p class="text-gray-700 leading-relaxed whitespace-pre-line">${message.content}</p>
                        </div>
                    </div>

                    <!-- æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ« -->
                    ${message.attachment_count > 0 ? `
                    <div>
                        <h4 class="font-medium text-gray-900 mb-4">æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«</h4>
                        <div class="space-y-2">
                            <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                <i class="fas fa-file text-gray-400 mr-3"></i>
                                <span class="flex-1 text-sm">æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ« ${message.attachment_count}ä»¶</span>
                                <button class="text-primary hover:text-blue-700 text-sm focus-ring rounded">
                                    <i class="fas fa-download mr-1"></i>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                                </button>
                            </div>
                        </div>
                    </div>
                    ` : ''}

                    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="flex justify-end space-x-4 pt-6 border-t">
                        <button onclick="replyMessage(${message.id})" class="px-6 py-3 bg-primary text-white rounded-md hover:bg-blue-700 transition-colors focus-ring">
                            <i class="fas fa-reply mr-2"></i>è¿”ä¿¡ã™ã‚‹
                        </button>
                        ${message.status !== 'completed' ? `
                        <button onclick="archiveMessage(${message.id})" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors focus-ring">
                            <i class="fas fa-archive mr-2"></i>ä¿ç®¡ã™ã‚‹
                        </button>
                        ` : ''}
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };

        // ã‚µãƒ¼ãƒ“ã‚¹ç”³è¾¼ç®¡ç†ã‚¯ãƒ©ã‚¹
        class ServicesManager {
            constructor() {
                this.baseURL = 'http://localhost:3001/api';
                this.currentService = null;
                this.currentStep = 1;
                this.formData = {};
                this.setupEventListeners();
                
                // ä¼æ¥­æƒ…å ±ï¼ˆå®Ÿéš›ã®é‹ç”¨ã§ã¯èªè¨¼æƒ…å ±ã‹ã‚‰å–å¾—ï¼‰
                this.companyInfo = {
                    company_name: 'æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«',
                    contact_person: 'ç”°ä¸­å¤ªéƒ',
                    email: 'tanaka@sample.co.jp',
                    phone: '03-1234-5678',
                    address: 'æ±äº¬éƒ½æ¸‹è°·åŒºã‚µãƒ³ãƒ—ãƒ«1-2-3'
                };

                // ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©
                this.serviceDefinitions = {
                    'customer-harassment': {
                        name: 'ã‚«ã‚¹ãƒãƒ©å‡ºå‹•ä¾é ¼',
                        category: 'emergency',
                        fields: [
                            { name: 'incident_location', label: 'ç™ºç”Ÿå ´æ‰€', type: 'text', required: true },
                            { name: 'incident_description', label: 'çŠ¶æ³è©³ç´°', type: 'textarea', required: true },
                            { name: 'customer_info', label: 'é¡§å®¢æƒ…å ±', type: 'textarea', required: false },
                            { name: 'urgency_level', label: 'ç·Šæ€¥åº¦', type: 'select', options: [
                                { value: 'immediate', label: 'å³æ™‚å¯¾å¿œå¿…è¦' },
                                { value: 'urgent', label: '1æ™‚é–“ä»¥å†…' },
                                { value: 'high', label: '3æ™‚é–“ä»¥å†…' }
                            ], required: true },
                            { name: 'preferred_time', label: 'å¸Œæœ›å¯¾å¿œæ™‚é–“', type: 'datetime-local', required: true }
                        ]
                    },
                    'security-seal': {
                        name: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚·ãƒ¼ãƒ«',
                        category: 'security',
                        fields: [
                            { name: 'seal_type', label: 'ã‚·ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—', type: 'select', options: [
                                { value: 'standard', label: 'æ¨™æº–ã‚¿ã‚¤ãƒ—' },
                                { value: 'custom', label: 'ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³' },
                                { value: 'reflective', label: 'åå°„æã‚¿ã‚¤ãƒ—' }
                            ], required: true },
                            { name: 'quantity', label: 'æšæ•°', type: 'number', required: true },
                            { name: 'installation_location', label: 'è¨­ç½®å ´æ‰€', type: 'textarea', required: true },
                            { name: 'design_requirements', label: 'ãƒ‡ã‚¶ã‚¤ãƒ³è¦æœ›', type: 'textarea', required: false },
                            { name: 'delivery_date', label: 'å¸Œæœ›ç´æœŸ', type: 'date', required: true }
                        ]
                    },
                    'security-training': {
                        name: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®',
                        category: 'training',
                        fields: [
                            { name: 'training_type', label: 'ç ”ä¿®ã‚¿ã‚¤ãƒ—', type: 'select', options: [
                                { value: 'basic', label: 'åŸºæœ¬ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®' },
                                { value: 'advanced', label: 'ä¸Šç´šãƒªã‚¹ã‚¯ç®¡ç†' },
                                { value: 'customer-service', label: 'æ¥å®¢ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£' }
                            ], required: true },
                            { name: 'participant_count', label: 'å‚åŠ äººæ•°', type: 'number', required: true },
                            { name: 'preferred_date', label: 'å¸Œæœ›æ—¥æ™‚', type: 'datetime-local', required: true },
                            { name: 'duration_hours', label: 'ç ”ä¿®æ™‚é–“', type: 'select', options: [
                                { value: '2', label: '2æ™‚é–“' },
                                { value: '3', label: '3æ™‚é–“' },
                                { value: '6', label: '6æ™‚é–“ï¼ˆ1æ—¥ï¼‰' }
                            ], required: true },
                            { name: 'special_requirements', label: 'ç‰¹åˆ¥ãªè¦æœ›', type: 'textarea', required: false }
                        ]
                    },
                    'risk-assessment': {
                        name: 'ãƒªã‚¹ã‚¯è¨ºæ–­',
                        category: 'consulting',
                        fields: [
                            { name: 'assessment_scope', label: 'è¨ºæ–­ç¯„å›²', type: 'checkbox', options: [
                                { value: 'physical', label: 'ç‰©ç†çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£' },
                                { value: 'personnel', label: 'äººçš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£' },
                                { value: 'information', label: 'æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£' },
                                { value: 'operational', label: 'é‹ç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£' }
                            ], required: true },
                            { name: 'facility_size', label: 'æ–½è¨­è¦æ¨¡', type: 'select', options: [
                                { value: 'small', label: 'å°è¦æ¨¡ï¼ˆ~500ã¡ï¼‰' },
                                { value: 'medium', label: 'ä¸­è¦æ¨¡ï¼ˆ500-2000ã¡ï¼‰' },
                                { value: 'large', label: 'å¤§è¦æ¨¡ï¼ˆ2000ã¡~ï¼‰' }
                            ], required: true },
                            { name: 'employee_count', label: 'å¾“æ¥­å“¡æ•°', type: 'number', required: true },
                            { name: 'preferred_schedule', label: 'å¸Œæœ›å®Ÿæ–½æ—¥', type: 'date', required: true },
                            { name: 'current_concerns', label: 'ç¾åœ¨ã®æ‡¸å¿µäº‹é …', type: 'textarea', required: false }
                        ]
                    },
                    'security-guard': {
                        name: 'è­¦å‚™å“¡æ´¾é£',
                        category: 'emergency',
                        fields: [
                            { name: 'guard_type', label: 'è­¦å‚™ã‚¿ã‚¤ãƒ—', type: 'select', options: [
                                { value: 'facility', label: 'æ–½è¨­è­¦å‚™' },
                                { value: 'event', label: 'ã‚¤ãƒ™ãƒ³ãƒˆè­¦å‚™' },
                                { value: 'vip', label: 'VIPè­¦è­·' }
                            ], required: true },
                            { name: 'guard_count', label: 'å¿…è¦äººæ•°', type: 'number', required: true },
                            { name: 'start_datetime', label: 'é–‹å§‹æ—¥æ™‚', type: 'datetime-local', required: true },
                            { name: 'end_datetime', label: 'çµ‚äº†æ—¥æ™‚', type: 'datetime-local', required: true },
                            { name: 'location_details', label: 'è­¦å‚™å ´æ‰€è©³ç´°', type: 'textarea', required: true },
                            { name: 'special_instructions', label: 'ç‰¹åˆ¥ãªæŒ‡ç¤º', type: 'textarea', required: false }
                        ]
                    },
                    'security-camera': {
                        name: 'é˜²çŠ¯ã‚«ãƒ¡ãƒ©è¨­ç½®',
                        category: 'security',
                        fields: [
                            { name: 'camera_count', label: 'è¨­ç½®å°æ•°', type: 'number', required: true },
                            { name: 'camera_type', label: 'ã‚«ãƒ¡ãƒ©ã‚¿ã‚¤ãƒ—', type: 'select', options: [
                                { value: 'indoor', label: 'å±‹å†…ç”¨' },
                                { value: 'outdoor', label: 'å±‹å¤–ç”¨' },
                                { value: 'mixed', label: 'å±‹å†…å¤–æ··åˆ' }
                            ], required: true },
                            { name: 'recording_system', label: 'éŒ²ç”»ã‚·ã‚¹ãƒ†ãƒ ', type: 'select', options: [
                                { value: 'local', label: 'ãƒ­ãƒ¼ã‚«ãƒ«éŒ²ç”»' },
                                { value: 'cloud', label: 'ã‚¯ãƒ©ã‚¦ãƒ‰éŒ²ç”»' },
                                { value: 'hybrid', label: 'ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰' }
                            ], required: true },
                            { name: 'installation_locations', label: 'è¨­ç½®å ´æ‰€', type: 'textarea', required: true },
                            { name: 'budget_range', label: 'äºˆç®—ç¯„å›²', type: 'select', options: [
                                { value: '200k', label: '20ä¸‡å††ä»¥ä¸‹' },
                                { value: '500k', label: '20-50ä¸‡å††' },
                                { value: '1000k', label: '50-100ä¸‡å††' },
                                { value: '1000k+', label: '100ä¸‡å††ä»¥ä¸Š' }
                            ], required: true }
                        ]
                    },
                    'legal-document': {
                        name: 'æ³•çš„æ›¸é¡ä½œæˆ',
                        category: 'consulting',
                        fields: [
                            { name: 'document_type', label: 'æ›¸é¡ã‚¿ã‚¤ãƒ—', type: 'select', options: [
                                { value: 'warning', label: 'è­¦å‘Šæ›¸' },
                                { value: 'cease_desist', label: 'å†…å®¹è¨¼æ˜éƒµä¾¿' },
                                { value: 'contract', label: 'å¥‘ç´„æ›¸' },
                                { value: 'agreement', label: 'åˆæ„æ›¸' }
                            ], required: true },
                            { name: 'target_party', label: 'ç›¸æ‰‹æ–¹æƒ…å ±', type: 'textarea', required: true },
                            { name: 'case_description', label: 'æ¡ˆä»¶æ¦‚è¦', type: 'textarea', required: true },
                            { name: 'desired_outcome', label: 'å¸Œæœ›ã™ã‚‹çµæœ', type: 'textarea', required: true },
                            { name: 'urgency', label: 'ç·Šæ€¥åº¦', type: 'select', options: [
                                { value: 'immediate', label: 'å³æ—¥' },
                                { value: 'urgent', label: '3æ—¥ä»¥å†…' },
                                { value: 'normal', label: '1é€±é–“ä»¥å†…' }
                            ], required: true }
                        ]
                    },
                    'emergency-consulting': {
                        name: 'ç·Šæ€¥ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°',
                        category: 'emergency',
                        fields: [
                            { name: 'emergency_type', label: 'ç·Šæ€¥äº‹æ…‹ã®ç¨®é¡', type: 'select', options: [
                                { value: 'harassment', label: 'é¡§å®¢ãƒˆãƒ©ãƒ–ãƒ«' },
                                { value: 'security_breach', label: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾µå®³' },
                                { value: 'threat', label: 'è„…è¿«ãƒ»æå–' },
                                { value: 'other', label: 'ãã®ä»–' }
                            ], required: true },
                            { name: 'situation_description', label: 'ç¾åœ¨ã®çŠ¶æ³', type: 'textarea', required: true },
                            { name: 'immediate_risk', label: 'ç·Šæ€¥æ€§ã®ç†ç”±', type: 'textarea', required: true },
                            { name: 'contact_method', label: 'å¸Œæœ›é€£çµ¡æ–¹æ³•', type: 'select', options: [
                                { value: 'phone', label: 'é›»è©±' },
                                { value: 'site_visit', label: 'ç¾åœ°å¯¾å¿œ' },
                                { value: 'video_call', label: 'ãƒ“ãƒ‡ã‚ªé€šè©±' }
                            ], required: true },
                            { name: 'availability', label: 'å¯¾å¿œå¯èƒ½æ™‚é–“', type: 'text', required: true }
                        ]
                    }
                };
            }

            setupEventListeners() {
                // ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£
                document.getElementById('close-service-modal-btn')?.addEventListener('click', () => {
                    this.hideServiceModal();
                });

                document.getElementById('service-cancel-btn')?.addEventListener('click', () => {
                    this.hideServiceModal();
                });

                document.getElementById('service-prev-btn')?.addEventListener('click', () => {
                    this.previousStep();
                });

                document.getElementById('service-next-btn')?.addEventListener('click', () => {
                    this.nextStep();
                });

                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
                document.getElementById('service-category-filter')?.addEventListener('change', () => {
                    this.filterServices();
                });

                document.getElementById('service-urgency-filter')?.addEventListener('change', () => {
                    this.filterServices();
                });

                document.getElementById('service-search')?.addEventListener('input', () => {
                    this.filterServices();
                });
            }

            openServiceApplication(serviceType) {
                this.currentService = serviceType;
                this.currentStep = 1;
                this.formData = { ...this.companyInfo }; // ä¼æ¥­æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼
                
                const serviceDef = this.serviceDefinitions[serviceType];
                if (!serviceDef) return;

                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
                document.getElementById('service-modal-title').textContent = serviceDef.name + ' ç”³è¾¼';
                
                // ã‚¹ãƒ†ãƒƒãƒ—1ã®å†…å®¹è¡¨ç¤º
                this.renderStep1();
                this.showServiceModal();
            }

            showServiceModal() {
                document.getElementById('service-application-modal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            hideServiceModal() {
                document.getElementById('service-application-modal').classList.add('hidden');
                document.body.style.overflow = 'auto';
                this.resetForm();
            }

            resetForm() {
                this.currentService = null;
                this.currentStep = 1;
                this.formData = {};
            }

            renderStep1() {
                const serviceDef = this.serviceDefinitions[this.currentService];
                const content = document.getElementById('service-form-content');
                
                content.innerHTML = `
                    <div class="space-y-6">
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <h4 class="font-semibold text-blue-900 mb-2">${serviceDef.name}</h4>
                            <p class="text-blue-700 text-sm">ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°ã‚’ç¢ºèªã—ã€å¿…è¦ãªæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
                        </div>

                        <!-- ä¼æ¥­æƒ…å ±è¡¨ç¤ºï¼ˆè‡ªå‹•å…¥åŠ›æ¸ˆã¿ï¼‰ -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h5 class="font-medium text-gray-900 mb-3">ç”³è¾¼ä¼æ¥­æƒ…å ±ï¼ˆè‡ªå‹•å…¥åŠ›æ¸ˆã¿ï¼‰</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="font-medium text-gray-700">ä¼æ¥­å:</span>
                                    <span class="ml-2 text-gray-900">${this.companyInfo.company_name}</span>
                                </div>
                                <div>
                                    <span class="font-medium text-gray-700">æ‹…å½“è€…:</span>
                                    <span class="ml-2 text-gray-900">${this.companyInfo.contact_person}</span>
                                </div>
                                <div>
                                    <span class="font-medium text-gray-700">é›»è©±ç•ªå·:</span>
                                    <span class="ml-2 text-gray-900">${this.companyInfo.phone}</span>
                                </div>
                                <div>
                                    <span class="font-medium text-gray-700">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</span>
                                    <span class="ml-2 text-gray-900">${this.companyInfo.email}</span>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <p class="text-gray-600">ä¼æ¥­æƒ…å ±ã¯è‡ªå‹•ã§å…¥åŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚<br>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
                        </div>
                    </div>
                `;

                this.updateStepIndicator(1);
                this.updateButtons();
            }

            renderStep2() {
                const serviceDef = this.serviceDefinitions[this.currentService];
                const content = document.getElementById('service-form-content');
                
                let fieldsHTML = serviceDef.fields.map(field => this.renderField(field)).join('');
                
                content.innerHTML = `
                    <form id="service-detail-form" class="space-y-6">
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-green-900 mb-2">ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°å…¥åŠ›</h4>
                            <p class="text-green-700 text-sm">å¿…è¦ãªæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆ<span class="text-red-600">*</span>ã¯å¿…é ˆé …ç›®ï¼‰</p>
                        </div>
                        ${fieldsHTML}
                    </form>
                `;

                this.updateStepIndicator(2);
                this.updateButtons();
            }

            renderStep3() {
                const serviceDef = this.serviceDefinitions[this.currentService];
                const content = document.getElementById('service-form-content');
                
                // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªè¡¨ç¤º
                let confirmationHTML = '';
                serviceDef.fields.forEach(field => {
                    const value = this.formData[field.name];
                    if (value) {
                        confirmationHTML += `
                            <div class="flex justify-between py-2 border-b">
                                <span class="font-medium text-gray-700">${field.label}:</span>
                                <span class="text-gray-900">${this.formatFieldValue(field, value)}</span>
                            </div>
                        `;
                    }
                });

                content.innerHTML = `
                    <div class="space-y-6">
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-yellow-900 mb-2">ç”³è¾¼å†…å®¹ç¢ºèª</h4>
                            <p class="text-yellow-700 text-sm">ä»¥ä¸‹ã®å†…å®¹ã§ç”³è¾¼ã‚’è¡Œã„ã¾ã™ã€‚é–“é•ã„ãŒãªã„ã‹ã”ç¢ºèªãã ã•ã„ã€‚</p>
                        </div>

                        <!-- ä¼æ¥­æƒ…å ± -->
                        <div>
                            <h5 class="font-semibold text-gray-900 mb-3">ä¼æ¥­æƒ…å ±</h5>
                            <div class="bg-gray-50 p-4 rounded">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-700">ä¼æ¥­å:</span>
                                        <span class="text-gray-900">${this.companyInfo.company_name}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-700">æ‹…å½“è€…:</span>
                                        <span class="text-gray-900">${this.companyInfo.contact_person}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ã‚µãƒ¼ãƒ“ã‚¹è©³ç´° -->
                        <div>
                            <h5 class="font-semibold text-gray-900 mb-3">ç”³è¾¼ã‚µãƒ¼ãƒ“ã‚¹: ${serviceDef.name}</h5>
                            <div class="bg-white border rounded p-4">
                                ${confirmationHTML}
                            </div>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-blue-700 text-sm">
                                <i class="fas fa-info-circle mr-2"></i>
                                ç”³è¾¼é€ä¿¡å¾Œã€æ‹…å½“è€…ã‚ˆã‚Šè©³ç´°ã®ç¢ºèªé€£çµ¡ã‚’ã„ãŸã—ã¾ã™ã€‚ç·Šæ€¥æ€§ã®é«˜ã„ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ã¯ã€å¯èƒ½ãªé™ã‚Šè¿…é€Ÿã«å¯¾å¿œã„ãŸã—ã¾ã™ã€‚
                            </p>
                        </div>
                    </div>
                `;

                this.updateStepIndicator(3);
                this.updateButtons();
            }

            renderField(field) {
                let fieldHTML = '';
                const required = field.required ? 'required' : '';
                const requiredMark = field.required ? '<span class="text-red-600">*</span>' : '';

                switch (field.type) {
                    case 'text':
                    case 'email':
                    case 'tel':
                    case 'number':
                    case 'date':
                    case 'datetime-local':
                        fieldHTML = `
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    ${field.label} ${requiredMark}
                                </label>
                                <input type="${field.type}" name="${field.name}" ${required}
                                       class="w-full border-gray-300 rounded-md focus-ring"
                                       placeholder="${field.placeholder || ''}">
                            </div>
                        `;
                        break;

                    case 'textarea':
                        fieldHTML = `
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    ${field.label} ${requiredMark}
                                </label>
                                <textarea name="${field.name}" rows="4" ${required}
                                          class="w-full border-gray-300 rounded-md focus-ring"
                                          placeholder="${field.placeholder || ''}"></textarea>
                            </div>
                        `;
                        break;

                    case 'select':
                        const options = field.options.map(opt => 
                            `<option value="${opt.value}">${opt.label}</option>`
                        ).join('');
                        fieldHTML = `
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    ${field.label} ${requiredMark}
                                </label>
                                <select name="${field.name}" ${required}
                                        class="w-full border-gray-300 rounded-md focus-ring">
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    ${options}
                                </select>
                            </div>
                        `;
                        break;

                    case 'checkbox':
                        const checkboxes = field.options.map(opt => `
                            <label class="flex items-center">
                                <input type="checkbox" name="${field.name}" value="${opt.value}"
                                       class="rounded border-gray-300 text-primary focus:ring-primary">
                                <span class="ml-2 text-sm text-gray-700">${opt.label}</span>
                            </label>
                        `).join('');
                        fieldHTML = `
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    ${field.label} ${requiredMark}
                                </label>
                                <div class="space-y-2">
                                    ${checkboxes}
                                </div>
                            </div>
                        `;
                        break;
                }

                return fieldHTML;
            }

            formatFieldValue(field, value) {
                if (field.type === 'checkbox') {
                    return Array.isArray(value) ? value.join(', ') : value;
                } else if (field.type === 'select') {
                    const option = field.options?.find(opt => opt.value === value);
                    return option ? option.label : value;
                }
                return value;
            }

            nextStep() {
                if (this.currentStep === 1) {
                    this.currentStep = 2;
                    this.renderStep2();
                } else if (this.currentStep === 2) {
                    if (this.validateStep2()) {
                        this.saveStep2Data();
                        this.currentStep = 3;
                        this.renderStep3();
                    }
                } else if (this.currentStep === 3) {
                    this.submitApplication();
                }
            }

            previousStep() {
                if (this.currentStep === 2) {
                    this.currentStep = 1;
                    this.renderStep1();
                } else if (this.currentStep === 3) {
                    this.currentStep = 2;
                    this.renderStep2();
                    // å‰å›å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                    this.restoreStep2Data();
                }
            }

            validateStep2() {
                const form = document.getElementById('service-detail-form');
                return form.checkValidity();
            }

            saveStep2Data() {
                const form = document.getElementById('service-detail-form');
                const formData = new FormData(form);
                
                for (const [key, value] of formData.entries()) {
                    this.formData[key] = value;
                }

                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å‡¦ç†
                const checkboxes = form.querySelectorAll('input[type="checkbox"]:checked');
                const checkboxGroups = {};
                checkboxes.forEach(cb => {
                    if (!checkboxGroups[cb.name]) {
                        checkboxGroups[cb.name] = [];
                    }
                    checkboxGroups[cb.name].push(cb.value);
                });
                
                Object.assign(this.formData, checkboxGroups);
            }

            restoreStep2Data() {
                const form = document.getElementById('service-detail-form');
                Object.keys(this.formData).forEach(key => {
                    const element = form.querySelector(`[name="${key}"]`);
                    if (element && element.type !== 'checkbox') {
                        element.value = this.formData[key];
                    }
                });

                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å¾©å…ƒ
                Object.keys(this.formData).forEach(key => {
                    if (Array.isArray(this.formData[key])) {
                        this.formData[key].forEach(value => {
                            const checkbox = form.querySelector(`input[name="${key}"][value="${value}"]`);
                            if (checkbox) checkbox.checked = true;
                        });
                    }
                });
            }

            async submitApplication() {
                try {
                    const submitBtn = document.getElementById('service-next-btn');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>é€ä¿¡ä¸­...';
                    submitBtn.disabled = true;

                    // APIã«é€ä¿¡ï¼ˆå®Ÿè£…ï¼‰
                    const response = await fetch(`${this.baseURL}/service-applications`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            service_type: this.currentService,
                            ...this.formData
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert('ç”³è¾¼ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚æ‹…å½“è€…ã‚ˆã‚Šé€£çµ¡ã„ãŸã—ã¾ã™ã€‚');
                        this.hideServiceModal();
                    } else {
                        throw new Error(result.error || 'ç”³è¾¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }

                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;

                } catch (error) {
                    console.error('ç”³è¾¼ã‚¨ãƒ©ãƒ¼:', error);
                    alert('ç”³è¾¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                    
                    const submitBtn = document.getElementById('service-next-btn');
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>ç”³è¾¼é€ä¿¡';
                    submitBtn.disabled = false;
                }
            }

            updateStepIndicator(currentStep) {
                const steps = document.querySelectorAll('.step-item');
                steps.forEach((step, index) => {
                    const stepNum = index + 1;
                    const circle = step.querySelector('.step-circle');
                    const text = step.querySelector('span');
                    
                    if (stepNum <= currentStep) {
                        circle.className = 'step-circle bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-medium';
                        text.className = 'ml-2 text-sm font-medium text-primary';
                    } else {
                        circle.className = 'step-circle bg-gray-300 text-gray-500 rounded-full w-8 h-8 flex items-center justify-center text-sm font-medium';
                        text.className = 'ml-2 text-sm font-medium text-gray-500';
                    }
                });
            }

            updateButtons() {
                const prevBtn = document.getElementById('service-prev-btn');
                const nextBtn = document.getElementById('service-next-btn');
                
                if (this.currentStep === 1) {
                    prevBtn.classList.add('hidden');
                    nextBtn.innerHTML = 'æ¬¡ã¸ <i class="fas fa-chevron-right ml-2"></i>';
                } else if (this.currentStep === 2) {
                    prevBtn.classList.remove('hidden');
                    nextBtn.innerHTML = 'æ¬¡ã¸ <i class="fas fa-chevron-right ml-2"></i>';
                } else if (this.currentStep === 3) {
                    prevBtn.classList.remove('hidden');
                    nextBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>ç”³è¾¼é€ä¿¡';
                }
            }

            filterServices() {
                const categoryFilter = document.getElementById('service-category-filter').value;
                const urgencyFilter = document.getElementById('service-urgency-filter').value;
                const searchTerm = document.getElementById('service-search').value.toLowerCase();

                const serviceCards = document.querySelectorAll('.service-card');
                
                serviceCards.forEach(card => {
                    const category = card.dataset.category;
                    const urgency = card.dataset.urgency;
                    const title = card.querySelector('h3').textContent.toLowerCase();
                    const description = card.querySelector('p').textContent.toLowerCase();

                    let show = true;

                    if (categoryFilter && category !== categoryFilter) show = false;
                    if (urgencyFilter && urgency !== urgencyFilter) show = false;
                    if (searchTerm && !title.includes(searchTerm) && !description.includes(searchTerm)) show = false;

                    card.style.display = show ? 'block' : 'none';
                });
            }
        }

        // è«‹æ±‚ãƒ»æ”¯æ‰•ã„ç®¡ç†ã‚¯ãƒ©ã‚¹
        class BillingManager {
            constructor() {
                this.baseURL = 'http://localhost:3001/api';
                this.invoices = [];
                this.setupEventListeners();
                this.loadInvoices(); // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            }

            setupEventListeners() {
                // ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£
                document.getElementById('close-billing-detail-modal-btn')?.addEventListener('click', () => {
                    this.hideBillingDetailModal();
                });

                document.getElementById('close-payment-options-modal-btn')?.addEventListener('click', () => {
                    this.hidePaymentOptionsModal();
                });

                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
                document.getElementById('billing-period-filter')?.addEventListener('change', () => {
                    this.filterInvoices();
                });

                document.getElementById('billing-status-filter')?.addEventListener('change', () => {
                    this.filterInvoices();
                });

                document.getElementById('billing-amount-filter')?.addEventListener('change', () => {
                    this.filterInvoices();
                });

                document.getElementById('billing-service-filter')?.addEventListener('change', () => {
                    this.filterInvoices();
                });

                document.getElementById('billing-search')?.addEventListener('input', () => {
                    this.filterInvoices();
                });
            }

            // APIã‹ã‚‰è«‹æ±‚æ›¸ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            async loadInvoices() {
                try {
                    const response = await fetch(`${this.baseURL}/invoices`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.invoices = data.data;
                        this.updateInvoiceTable();
                        this.updateSummary();
                    } else {
                        console.error('è«‹æ±‚æ›¸ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', data.error);
                        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
                        this.loadSampleData();
                    }
                } catch (error) {
                    console.error('APIã‚¨ãƒ©ãƒ¼:', error);
                    // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
                    this.loadSampleData();
                }
            }

            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼ˆAPIæœªå®Ÿè£…æ™‚ã®ä»£æ›¿ï¼‰
            loadSampleData() {
                this.invoices = [
                    {
                        id: 1,
                        invoice_number: 'INV-2024-08-001',
                        invoice_date: '2024-08-01',
                        due_date: '2024-08-31',
                        service_type: 'monthly',
                        service_name: 'æœˆé¡åŸºæœ¬æ–™é‡‘',
                        amount: 150000,
                        tax_amount: 15000,
                        total_amount: 165000,
                        status: 'paid',
                        description: '8æœˆåˆ†æœˆé¡åŸºæœ¬æ–™é‡‘'
                    },
                    {
                        id: 2,
                        invoice_number: 'INV-2024-07-015',
                        invoice_date: '2024-07-25',
                        due_date: '2024-08-25',
                        service_type: 'emergency',
                        service_name: 'ç·Šæ€¥å‡ºå‹•æ–™é‡‘',
                        amount: 320000,
                        tax_amount: 32000,
                        total_amount: 352000,
                        status: 'pending',
                        description: 'ã‚«ã‚¹ãƒãƒ©ç·Šæ€¥å‡ºå‹•å¯¾å¿œ'
                    },
                    {
                        id: 3,
                        invoice_number: 'INV-2024-07-008',
                        invoice_date: '2024-07-10',
                        due_date: '2024-08-10',
                        service_type: 'training',
                        service_name: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®',
                        amount: 80000,
                        tax_amount: 8000,
                        total_amount: 88000,
                        status: 'paid',
                        description: 'å…¨ç¤¾å“¡å‘ã‘ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®'
                    }
                ];
                this.updateInvoiceTable();
                this.updateSummary();
            }

            // è«‹æ±‚æ›¸ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°
            updateInvoiceTable() {
                const tbody = document.getElementById('billing-table-body');
                if (!tbody) return;

                tbody.innerHTML = '';

                this.invoices.forEach(invoice => {
                    const row = this.createInvoiceRow(invoice);
                    tbody.appendChild(row);
                });

                // ãƒ¢ãƒã‚¤ãƒ«ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚‚æ›´æ–°
                this.updateMobileBillingCards();
            }

            // ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ç”¨è«‹æ±‚æ›¸ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºæ›´æ–°
            updateMobileBillingCards() {
                const container = document.getElementById('billing-cards-container');
                if (!container) return;

                container.innerHTML = this.invoices.map(invoice => {
                    const statusBadge = this.getStatusBadge(invoice.status);
                    const serviceTypeBadge = this.getServiceTypeBadge(invoice.service_type);
                    const iconClass = this.getServiceIcon(invoice.service_type);
                    const isOverdue = invoice.status === 'pending' && new Date(invoice.due_date) < new Date();

                    return `
                        <div class="bg-white rounded-lg border p-4 shadow-sm ${isOverdue ? 'border-red-200' : ''}">
                            <!-- è«‹æ±‚æ›¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                        <i class="fas ${iconClass} text-blue-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-900">${invoice.invoice_number}</div>
                                        <div class="text-sm text-gray-500">${invoice.service_name}</div>
                                    </div>
                                </div>
                                ${statusBadge}
                            </div>

                            <!-- é‡‘é¡ãƒ»æ—¥ä»˜æƒ…å ± -->
                            <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                                <div>
                                    <div class="text-gray-500">è«‹æ±‚é‡‘é¡</div>
                                    <div class="font-bold text-lg text-gray-900">Â¥${this.formatNumber(invoice.total_amount)}</div>
                                    <div class="text-gray-500 text-xs">ï¼ˆç¨è¾¼ï¼‰</div>
                                </div>
                                <div>
                                    <div class="text-gray-500">æ”¯æ‰•æœŸé™</div>
                                    <div class="font-medium ${isOverdue ? 'text-red-600' : 'text-gray-900'}">${this.formatDate(invoice.due_date)}</div>
                                    ${isOverdue ? '<div class="text-red-500 text-xs font-medium">æœŸé™åˆ‡ã‚Œ</div>' : ''}
                                </div>
                            </div>

                            <!-- ã‚µãƒ¼ãƒ“ã‚¹ç¨®åˆ¥ -->
                            <div class="mb-4">
                                ${serviceTypeBadge}
                            </div>

                            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                            <div class="flex justify-end space-x-2">
                                <button 
                                    onclick="showBillingDetail(${invoice.id})" 
                                    class="px-3 py-2 bg-blue-100 text-blue-700 rounded-md text-sm hover:bg-blue-200 transition-colors"
                                >
                                    <i class="fas fa-eye mr-1"></i>è©³ç´°
                                </button>
                                <button 
                                    onclick="downloadInvoicePDF(${invoice.id})" 
                                    class="px-3 py-2 bg-green-100 text-green-700 rounded-md text-sm hover:bg-green-200 transition-colors"
                                >
                                    <i class="fas fa-download mr-1"></i>PDF
                                </button>
                                ${invoice.status === 'pending' ? `
                                <button 
                                    onclick="showPaymentOptions(${invoice.id})" 
                                    class="px-3 py-2 bg-purple-100 text-purple-700 rounded-md text-sm hover:bg-purple-200 transition-colors"
                                >
                                    <i class="fas fa-credit-card mr-1"></i>æ”¯æ‰•ã„
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // è«‹æ±‚æ›¸è¡Œã‚’ä½œæˆ
            createInvoiceRow(invoice) {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';

                const statusBadge = this.getStatusBadge(invoice.status);
                const serviceTypeBadge = this.getServiceTypeBadge(invoice.service_type);
                const iconClass = this.getServiceIcon(invoice.service_type);

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <i class="fas ${iconClass} mr-3"></i>
                            <div>
                                <div class="text-sm font-medium text-gray-900">${invoice.invoice_number}</div>
                                <div class="text-sm text-gray-500">${invoice.description}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${this.formatDate(invoice.invoice_date)}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${this.formatDate(invoice.due_date)}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${serviceTypeBadge}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">Â¥${this.formatNumber(invoice.amount)}</div>
                        <div class="text-sm text-gray-500">ç¨è¾¼ Â¥${this.formatNumber(invoice.total_amount)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${statusBadge}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                        <button class="text-blue-600 hover:text-blue-700 focus-ring rounded" onclick="showBillingDetail(${invoice.id})">
                            <i class="fas fa-eye mr-1"></i>è©³ç´°
                        </button>
                        <button class="text-green-600 hover:text-green-700 focus-ring rounded" onclick="downloadInvoicePDF(${invoice.id})">
                            <i class="fas fa-download mr-1"></i>PDF
                        </button>
                        ${invoice.status === 'pending' ? `
                        <button class="text-purple-600 hover:text-purple-700 focus-ring rounded" onclick="showPaymentOptions(${invoice.id})">
                            <i class="fas fa-credit-card mr-1"></i>æ”¯æ‰•ã„
                        </button>
                        ` : ''}
                    </td>
                `;

                return row;
            }

            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
            getStatusBadge(status) {
                const badges = {
                    'paid': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><i class="fas fa-check mr-1"></i>æ”¯æ‰•ã„æ¸ˆã¿</span>',
                    'pending': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"><i class="fas fa-clock mr-1"></i>æ”¯æ‰•ã„å¾…ã¡</span>',
                    'overdue': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"><i class="fas fa-exclamation-triangle mr-1"></i>å»¶æ»ä¸­</span>'
                };
                return badges[status] || badges['pending'];
            }

            // ã‚µãƒ¼ãƒ“ã‚¹ã‚¿ã‚¤ãƒ—ãƒãƒƒã‚¸
            getServiceTypeBadge(serviceType) {
                const badges = {
                    'monthly': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">æœˆé¡ã‚µãƒ¼ãƒ“ã‚¹</span>',
                    'emergency': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">ç·Šæ€¥å¯¾å¿œ</span>',
                    'training': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">ç ”ä¿®ãƒ»æ•™è‚²</span>',
                    'equipment': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">æ©Ÿå™¨ãƒ»è¨­å‚™</span>'
                };
                return badges[serviceType] || badges['monthly'];
            }

            // ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚¤ã‚³ãƒ³
            getServiceIcon(serviceType) {
                const icons = {
                    'monthly': 'fa-file-invoice text-blue-500',
                    'emergency': 'fa-file-invoice text-red-500',
                    'training': 'fa-file-invoice text-green-500',
                    'equipment': 'fa-file-invoice text-purple-500'
                };
                return icons[serviceType] || 'fa-file-invoice text-blue-500';
            }

            // æ•°å€¤ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            formatNumber(number) {
                return new Intl.NumberFormat('ja-JP').format(number);
            }

            // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            formatDate(dateString) {
                const date = new Date(dateString);
                return `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
            }

            // ã‚µãƒãƒªãƒ¼æ›´æ–°
            updateSummary() {
                const currentMonth = new Date().getMonth() + 1;
                const currentYear = new Date().getFullYear();
                
                // ä»Šæœˆã®è«‹æ±‚é¡è¨ˆç®—
                const thisMonthInvoices = this.invoices.filter(inv => {
                    const invDate = new Date(inv.invoice_date);
                    return invDate.getMonth() + 1 === currentMonth && invDate.getFullYear() === currentYear;
                });
                
                const thisMonthTotal = thisMonthInvoices.reduce((sum, inv) => sum + inv.total_amount, 0);
                const paidTotal = this.invoices.filter(inv => inv.status === 'paid').reduce((sum, inv) => sum + inv.total_amount, 0);
                const pendingTotal = this.invoices.filter(inv => inv.status === 'pending').reduce((sum, inv) => sum + inv.total_amount, 0);
                const overdueTotal = this.invoices.filter(inv => inv.status === 'overdue').reduce((sum, inv) => sum + inv.total_amount, 0);

                // ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°ï¼ˆå®Ÿè£…äºˆå®šï¼‰
                console.log('ã‚µãƒãƒªãƒ¼æ›´æ–°:', { thisMonthTotal, paidTotal, pendingTotal, overdueTotal });
            }

            // è«‹æ±‚æ›¸è©³ç´°è¡¨ç¤º
            showBillingDetail(invoiceId) {
                const invoice = this.invoices.find(inv => inv.id === invoiceId);
                if (!invoice) return;

                const modal = document.getElementById('billing-detail-modal');
                const content = document.getElementById('billing-detail-content');
                
                content.innerHTML = `
                    <div class="space-y-6">
                        <!-- è«‹æ±‚æ›¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-medium text-gray-900 mb-3">è«‹æ±‚æ›¸æƒ…å ±</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">è«‹æ±‚æ›¸ç•ªå·:</span>
                                            <span class="font-medium">${invoice.invoice_number}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">è«‹æ±‚æ—¥:</span>
                                            <span>${this.formatDate(invoice.invoice_date)}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">æ”¯æ‰•æœŸé™:</span>
                                            <span>${this.formatDate(invoice.due_date)}</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-900 mb-3">é‡‘é¡è©³ç´°</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">å°è¨ˆ:</span>
                                            <span>Â¥${this.formatNumber(invoice.amount)}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">æ¶ˆè²»ç¨:</span>
                                            <span>Â¥${this.formatNumber(invoice.tax_amount)}</span>
                                        </div>
                                        <div class="flex justify-between border-t pt-2 font-medium">
                                            <span class="text-gray-900">åˆè¨ˆ:</span>
                                            <span class="text-lg">Â¥${this.formatNumber(invoice.total_amount)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ã‚µãƒ¼ãƒ“ã‚¹è©³ç´° -->
                        <div>
                            <h4 class="font-medium text-gray-900 mb-3">ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹</h4>
                            <div class="bg-white border rounded-lg p-4">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h5 class="font-medium text-gray-900">${invoice.service_name}</h5>
                                        <p class="text-gray-600 text-sm">${invoice.description}</p>
                                        <div class="mt-2">
                                            ${this.getServiceTypeBadge(invoice.service_type)}
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-medium">Â¥${this.formatNumber(invoice.total_amount)}</div>
                                        <div class="text-sm text-gray-500">ç¨è¾¼</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                        <div class="flex justify-end space-x-4 pt-6 border-t">
                            <button onclick="downloadInvoicePDF(${invoice.id})" class="px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors focus-ring">
                                <i class="fas fa-download mr-2"></i>PDF ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                            </button>
                            ${invoice.status === 'pending' ? `
                            <button onclick="window.billingManager.hideBillingDetailModal(); showPaymentOptions(${invoice.id})" class="px-6 py-3 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors focus-ring">
                                <i class="fas fa-credit-card mr-2"></i>æ”¯æ‰•ã„æ‰‹ç¶šã
                            </button>
                            ` : ''}
                        </div>
                    </div>
                `;

                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            hideBillingDetailModal() {
                document.getElementById('billing-detail-modal').classList.add('hidden');
                document.body.style.overflow = 'auto';
            }

            showPaymentOptions(invoiceId) {
                const modal = document.getElementById('payment-options-modal');
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            hidePaymentOptionsModal() {
                document.getElementById('payment-options-modal').classList.add('hidden');
                document.body.style.overflow = 'auto';
            }

            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
            filterInvoices() {
                const periodFilter = document.getElementById('billing-period-filter').value;
                const statusFilter = document.getElementById('billing-status-filter').value;
                const amountFilter = document.getElementById('billing-amount-filter').value;
                const serviceFilter = document.getElementById('billing-service-filter').value;
                const searchTerm = document.getElementById('billing-search').value.toLowerCase();

                console.log('ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨:', { periodFilter, statusFilter, amountFilter, serviceFilter, searchTerm });
                // å®Ÿéš›ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‡¦ç†ã‚’ã“ã“ã«å®Ÿè£…
            }

            // PDF ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            downloadInvoicePDF(invoiceId) {
                const invoice = this.invoices.find(inv => inv.id === invoiceId);
                if (!invoice) return;

                // å®Ÿéš›ã®å®Ÿè£…ã§ã¯APIã‚’å‘¼ã³å‡ºã—
                alert(`${invoice.invoice_number} ã®PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã™ï¼ˆå®Ÿè£…äºˆå®šï¼‰`);
            }
        }

        // ====================
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚¯ãƒ©ã‚¹
        // ====================
        class UserManager {
            constructor() {
                this.users = [];
                this.filteredUsers = [];
                this.currentPage = 1;
                this.usersPerPage = 10;
                this.baseURL = 'http://localhost:3001/api';
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadUsers();
            }

            setupEventListeners() {
                // æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
                document.getElementById('user-search')?.addEventListener('input', () => {
                    this.filterUsers();
                });

                document.getElementById('role-filter')?.addEventListener('change', () => {
                    this.filterUsers();
                });

                document.getElementById('status-filter')?.addEventListener('change', () => {
                    this.filterUsers();
                });

                // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
                document.getElementById('refresh-users-btn')?.addEventListener('click', () => {
                    this.loadUsers();
                });

                document.getElementById('add-user-btn')?.addEventListener('click', () => {
                    this.showAddUserModal();
                });

                // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
                document.getElementById('users-prev-page')?.addEventListener('click', () => {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.updateUserTable();
                    }
                });

                document.getElementById('users-next-page')?.addEventListener('click', () => {
                    const totalPages = Math.ceil(this.filteredUsers.length / this.usersPerPage);
                    if (this.currentPage < totalPages) {
                        this.currentPage++;
                        this.updateUserTable();
                    }
                });

                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆ
                document.getElementById('save-user-btn')?.addEventListener('click', () => {
                    this.saveUser();
                });

                document.getElementById('cancel-edit-btn')?.addEventListener('click', () => {
                    this.hideEditModal();
                });
            }

            // APIã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            async loadUsers() {
                try {
                    // å®Ÿéš›ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå®Ÿè£…ã•ã‚Œã‚‹ã¾ã§ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
                    this.loadSampleUsers();
                } catch (error) {
                    console.error('APIã‚¨ãƒ©ãƒ¼:', error);
                    this.loadSampleUsers();
                }
            }

            // ã‚µãƒ³ãƒ—ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆAPIå®Ÿè£…å‰ï¼‰
            loadSampleUsers() {
                this.users = [
                    {
                        id: 1,
                        name: 'ç”°ä¸­å¤ªéƒ',
                        email: 'tanaka@company.com',
                        role: 'ClientAdmin',
                        status: 'active',
                        last_login: '2024-08-28 10:30:00',
                        created_at: '2024-06-01 09:00:00',
                        login_count: 45
                    },
                    {
                        id: 2,
                        name: 'ä½è—¤èŠ±å­',
                        email: 'sato@company.com',
                        role: 'ClientUser',
                        status: 'active',
                        last_login: '2024-08-27 16:45:00',
                        created_at: '2024-06-15 14:20:00',
                        login_count: 23
                    },
                    {
                        id: 3,
                        name: 'éˆ´æœ¨ä¸€éƒ',
                        email: 'suzuki@company.com',
                        role: 'ClientUser',
                        status: 'active',
                        last_login: '2024-08-26 11:20:00',
                        created_at: '2024-07-01 10:30:00',
                        login_count: 12
                    },
                    {
                        id: 4,
                        name: 'é«˜æ©‹ç¾å’Œ',
                        email: 'takahashi@company.com',
                        role: 'ClientUser',
                        status: 'inactive',
                        last_login: '2024-07-20 09:15:00',
                        created_at: '2024-05-15 13:45:00',
                        login_count: 8
                    }
                ];

                this.filteredUsers = [...this.users];
                this.updateUserTable();
                this.loadActivityLog();
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            filterUsers() {
                const searchTerm = document.getElementById('user-search').value.toLowerCase();
                const roleFilter = document.getElementById('role-filter').value;
                const statusFilter = document.getElementById('status-filter').value;

                this.filteredUsers = this.users.filter(user => {
                    const matchesSearch = user.name.toLowerCase().includes(searchTerm) || 
                                         user.email.toLowerCase().includes(searchTerm);
                    const matchesRole = !roleFilter || user.role === roleFilter;
                    const matchesStatus = !statusFilter || user.status === statusFilter;

                    return matchesSearch && matchesRole && matchesStatus;
                });

                this.currentPage = 1;
                this.updateUserTable();
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
            updateUserTable() {
                const tbody = document.getElementById('users-table-body');
                const startIndex = (this.currentPage - 1) * this.usersPerPage;
                const endIndex = startIndex + this.usersPerPage;
                const pageUsers = this.filteredUsers.slice(startIndex, endIndex);

                tbody.innerHTML = pageUsers.map(user => `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    <div class="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center">
                                        <i class="fas fa-user text-gray-500"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${user.name}</div>
                                    <div class="text-sm text-gray-500">${user.email}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${this.getRoleBadge(user.role)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${this.getStatusBadge(user.status)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${this.formatDateTime(user.last_login)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                            <button 
                                onclick="userManager.editUser(${user.id})" 
                                class="text-blue-600 hover:text-blue-900 focus-ring rounded"
                            >
                                <i class="fas fa-edit mr-1"></i>ç·¨é›†
                            </button>
                            <button 
                                onclick="userManager.viewUserActivity(${user.id})" 
                                class="text-green-600 hover:text-green-900 focus-ring rounded"
                            >
                                <i class="fas fa-history mr-1"></i>å±¥æ­´
                            </button>
                            ${user.status === 'active' ? 
                                `<button onclick="userManager.toggleUserStatus(${user.id})" class="text-yellow-600 hover:text-yellow-900 focus-ring rounded">
                                    <i class="fas fa-pause mr-1"></i>ç„¡åŠ¹åŒ–
                                </button>` : 
                                `<button onclick="userManager.toggleUserStatus(${user.id})" class="text-green-600 hover:text-green-900 focus-ring rounded">
                                    <i class="fas fa-play mr-1"></i>æœ‰åŠ¹åŒ–
                                </button>`
                            }
                        </td>
                    </tr>
                `).join('');

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã¨ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’æ›´æ–°
                document.getElementById('users-count').textContent = `(${this.filteredUsers.length}å)`;
                
                const totalPages = Math.ceil(this.filteredUsers.length / this.usersPerPage);
                const showingStart = startIndex + 1;
                const showingEnd = Math.min(endIndex, this.filteredUsers.length);
                
                document.getElementById('users-pagination-info').textContent = 
                    `${showingStart}-${showingEnd} of ${this.filteredUsers.length} users`;
                
                // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹
                document.getElementById('users-prev-page').disabled = this.currentPage === 1;
                document.getElementById('users-next-page').disabled = this.currentPage === totalPages;
                
                // ãƒ¢ãƒã‚¤ãƒ«ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚‚æ›´æ–°
                this.updateMobileCards(pageUsers);
            }

            // ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºæ›´æ–°
            updateMobileCards(users) {
                const container = document.getElementById('users-cards-container');
                if (!container) return;

                container.innerHTML = users.map(user => `
                    <div class="bg-white rounded-lg border p-4 shadow-sm">
                        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åŸºæœ¬æƒ…å ± -->
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-gray-500"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-900">${user.name}</div>
                                    <div class="text-sm text-gray-500">${user.email}</div>
                                </div>
                            </div>
                            ${this.getStatusBadge(user.status)}
                        </div>

                        <!-- æ¨©é™ãƒ»æƒ…å ± -->
                        <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                            <div>
                                <div class="text-gray-500">æ¨©é™ãƒ¬ãƒ™ãƒ«</div>
                                <div class="mt-1">${this.getRoleBadge(user.role)}</div>
                            </div>
                            <div>
                                <div class="text-gray-500">æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³</div>
                                <div class="mt-1 font-medium">${this.formatDateTime(user.last_login)}</div>
                            </div>
                        </div>

                        <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                        <div class="flex justify-end space-x-2">
                            <button 
                                onclick="userManager.editUser(${user.id})" 
                                class="px-3 py-2 bg-blue-100 text-blue-700 rounded-md text-sm hover:bg-blue-200 transition-colors"
                            >
                                <i class="fas fa-edit mr-1"></i>ç·¨é›†
                            </button>
                            <button 
                                onclick="userManager.viewUserActivity(${user.id})" 
                                class="px-3 py-2 bg-green-100 text-green-700 rounded-md text-sm hover:bg-green-200 transition-colors"
                            >
                                <i class="fas fa-history mr-1"></i>å±¥æ­´
                            </button>
                            <button 
                                onclick="userManager.toggleUserStatus(${user.id})" 
                                class="px-3 py-2 ${user.status === 'active' ? 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200' : 'bg-green-100 text-green-700 hover:bg-green-200'} rounded-md text-sm transition-colors"
                            >
                                <i class="fas fa-${user.status === 'active' ? 'pause' : 'play'} mr-1"></i>
                                ${user.status === 'active' ? 'ç„¡åŠ¹åŒ–' : 'æœ‰åŠ¹åŒ–'}
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            // æ¨©é™ãƒ¬ãƒ™ãƒ«ãƒãƒƒã‚¸
            getRoleBadge(role) {
                const badges = {
                    'ClientAdmin': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"><i class="fas fa-crown mr-1"></i>ç®¡ç†è€…</span>',
                    'ClientUser': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"><i class="fas fa-user mr-1"></i>ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼</span>'
                };
                return badges[role] || '<span class="text-gray-500">æœªè¨­å®š</span>';
            }

            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
            getStatusBadge(status) {
                const badges = {
                    'active': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><i class="fas fa-check-circle mr-1"></i>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</span>',
                    'inactive': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"><i class="fas fa-pause-circle mr-1"></i>ç„¡åŠ¹</span>'
                };
                return badges[status] || '<span class="text-gray-500">ä¸æ˜</span>';
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
            editUser(userId) {
                const user = this.users.find(u => u.id === userId);
                if (!user) return;

                document.getElementById('modal-title').textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†';
                document.getElementById('edit-user-id').value = user.id;
                document.getElementById('edit-user-name').value = user.name;
                document.getElementById('edit-user-email').value = user.email;
                document.getElementById('edit-user-role').value = user.role;
                document.getElementById('edit-user-status').value = user.status;

                document.getElementById('user-edit-modal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            // æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
            showAddUserModal() {
                document.getElementById('modal-title').textContent = 'æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ';
                document.getElementById('user-edit-form').reset();
                document.getElementById('edit-user-id').value = '';

                document.getElementById('user-edit-modal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’éè¡¨ç¤º
            hideEditModal() {
                document.getElementById('user-edit-modal').classList.add('hidden');
                document.body.style.overflow = 'auto';
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¿å­˜
            async saveUser() {
                const formData = new FormData(document.getElementById('user-edit-form'));
                const userId = formData.get('userId');
                
                const userData = {
                    name: formData.get('userName'),
                    email: formData.get('userEmail'),
                    role: formData.get('userRole'),
                    status: formData.get('userStatus')
                };

                try {
                    // å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã¯ã“ã“ã«å®Ÿè£…
                    if (userId) {
                        // æ›´æ–°
                        const userIndex = this.users.findIndex(u => u.id == userId);
                        if (userIndex !== -1) {
                            this.users[userIndex] = { ...this.users[userIndex], ...userData };
                        }
                        alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ');
                    } else {
                        // æ–°è¦è¿½åŠ 
                        const newUser = {
                            id: Math.max(...this.users.map(u => u.id)) + 1,
                            ...userData,
                            last_login: null,
                            created_at: new Date().toISOString(),
                            login_count: 0
                        };
                        this.users.push(newUser);
                        alert('æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ');
                    }

                    this.filterUsers();
                    this.hideEditModal();

                } catch (error) {
                    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                    alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ‡ã‚Šæ›¿ãˆ
            toggleUserStatus(userId) {
                const user = this.users.find(u => u.id === userId);
                if (!user) return;

                const newStatus = user.status === 'active' ? 'inactive' : 'active';
                const action = newStatus === 'active' ? 'æœ‰åŠ¹åŒ–' : 'ç„¡åŠ¹åŒ–';

                if (confirm(`${user.name} ã‚’${action}ã—ã¾ã™ã‹ï¼Ÿ`)) {
                    user.status = newStatus;
                    this.updateUserTable();
                    alert(`${user.name} ãŒ${action}ã•ã‚Œã¾ã—ãŸ`);
                }
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£è¡¨ç¤º
            viewUserActivity(userId) {
                const user = this.users.find(u => u.id === userId);
                if (!user) return;

                alert(`${user.name} ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£:\nãƒ»ãƒ­ã‚°ã‚¤ãƒ³å›æ•°: ${user.login_count}å›\nãƒ»æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³: ${this.formatDateTime(user.last_login)}\nãƒ»ä½œæˆæ—¥: ${this.formatDateTime(user.created_at)}`);
            }

            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°èª­ã¿è¾¼ã¿
            loadActivityLog() {
                const activityLog = document.getElementById('activity-log');
                
                // ã‚µãƒ³ãƒ—ãƒ«ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ‡ãƒ¼ã‚¿
                const activities = [
                    {
                        user: 'ç”°ä¸­å¤ªéƒ',
                        action: 'ãƒ­ã‚°ã‚¤ãƒ³',
                        timestamp: '2024-08-28 10:30:00',
                        details: 'IPã‚¢ãƒ‰ãƒ¬ã‚¹: 192.168.1.100'
                    },
                    {
                        user: 'ä½è—¤èŠ±å­',
                        action: 'è«‹æ±‚æ›¸ç¢ºèª',
                        timestamp: '2024-08-27 16:45:00',
                        details: 'è«‹æ±‚æ›¸ INV-2024-08-001 ã‚’é–²è¦§'
                    },
                    {
                        user: 'éˆ´æœ¨ä¸€éƒ',
                        action: 'ã‚µãƒ¼ãƒ“ã‚¹ç”³è«‹',
                        timestamp: '2024-08-26 14:20:00',
                        details: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®ã‚’ç”³è«‹'
                    },
                    {
                        user: 'ç”°ä¸­å¤ªéƒ',
                        action: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†',
                        timestamp: '2024-08-26 11:15:00',
                        details: 'ä½è—¤èŠ±å­ ã®æ¨©é™ã‚’å¤‰æ›´'
                    }
                ];

                activityLog.innerHTML = activities.map(activity => `
                    <div class="flex items-start space-x-4 p-3 bg-gray-50 rounded-lg">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-history text-blue-600 text-sm"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center space-x-2">
                                <span class="font-medium text-gray-900">${activity.user}</span>
                                <span class="text-gray-500">â€¢</span>
                                <span class="text-gray-600">${activity.action}</span>
                            </div>
                            <p class="text-sm text-gray-500 mt-1">${activity.details}</p>
                        </div>
                        <div class="flex-shrink-0 text-xs text-gray-400">
                            ${this.formatDateTime(activity.timestamp)}
                        </div>
                    </div>
                `).join('');
            }

            // æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            formatDateTime(dateString) {
                if (!dateString) return 'æœªãƒ­ã‚°ã‚¤ãƒ³';
                
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

                if (diffDays === 0) {
                    return 'ä»Šæ—¥ ' + date.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
                } else if (diffDays === 1) {
                    return 'æ˜¨æ—¥ ' + date.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
                } else if (diffDays < 7) {
                    return `${diffDays}æ—¥å‰`;
                } else {
                    return date.toLocaleDateString('ja-JP');
                }
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        function openServiceApplication(serviceType) {
            if (window.servicesManager) {
                window.servicesManager.openServiceApplication(serviceType);
            }
        }

        function showBillingDetail(invoiceId) {
            if (window.billingManager) {
                window.billingManager.showBillingDetail(invoiceId);
            }
        }

        // ====================
        // ğŸ”” é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒ©ã‚¹
        // ====================
        class NotificationManager {
            constructor() {
                this.notifications = [];
                this.unreadCount = 0;
                this.settings = {
                    payment: true,
                    urgent: true,
                    general: true,
                    paymentReminders: {
                        days14: true,
                        days7: true,
                        days3: true,
                        sameDay: true,
                        overdue: true
                    },
                    browserNotifications: true,
                    emailNotifications: false
                };
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadNotifications();
                this.setupBrowserNotifications();
                this.startPaymentReminders();
                
                console.log('é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
            }

            setupEventListeners() {
                // é€šçŸ¥ãƒ‘ãƒãƒ«ã®é–‹é–‰
                document.getElementById('notification-toggle')?.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.toggleNotificationPanel();
                });

                // ãƒ‘ãƒãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
                document.addEventListener('click', (e) => {
                    const panel = document.getElementById('notification-panel');
                    const toggle = document.getElementById('notification-toggle');
                    
                    if (panel && !panel.contains(e.target) && !toggle.contains(e.target)) {
                        panel.classList.add('hidden');
                    }
                });

                // å…¨ã¦æ—¢èª­
                document.getElementById('mark-all-read')?.addEventListener('click', () => {
                    this.markAllAsRead();
                });

                // é€šçŸ¥è¨­å®š
                document.getElementById('notification-settings')?.addEventListener('click', () => {
                    this.showSettingsModal();
                });

                // è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«
                document.getElementById('cancel-notification-settings')?.addEventListener('click', () => {
                    this.hideSettingsModal();
                });

                document.getElementById('save-notification-settings')?.addEventListener('click', () => {
                    this.saveSettings();
                });
            }

            // ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥ã®è¨±å¯å–å¾—
            async setupBrowserNotifications() {
                if ('Notification' in window && Notification.permission === 'default') {
                    const permission = await Notification.requestPermission();
                    console.log('Browser notification permission:', permission);
                }
            }

            // é€šçŸ¥ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            loadNotifications() {
                // ã‚µãƒ³ãƒ—ãƒ«é€šçŸ¥ãƒ‡ãƒ¼ã‚¿
                this.notifications = [
                    {
                        id: 1,
                        type: 'payment',
                        title: 'æ”¯æ‰•æœŸé™ã®ãŠçŸ¥ã‚‰ã›',
                        message: 'è«‹æ±‚æ›¸ INV-2024-07-015 ã®æ”¯æ‰•æœŸé™ãŒæ˜æ—¥ã§ã™ï¼ˆÂ¥352,000ï¼‰',
                        timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2æ™‚é–“å‰
                        read: false,
                        priority: 'high',
                        actionUrl: '/c/billing',
                        icon: 'fas fa-credit-card',
                        color: 'text-red-600'
                    },
                    {
                        id: 2,
                        type: 'urgent',
                        title: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ›´æ–°',
                        message: 'ã‚·ã‚¹ãƒ†ãƒ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ›´æ–°ãŒå®Œäº†ã—ã¾ã—ãŸã€‚æ–°æ©Ÿèƒ½ã‚’ã”ç¢ºèªãã ã•ã„ã€‚',
                        timestamp: new Date(Date.now() - 4 * 60 * 60 * 1000), // 4æ™‚é–“å‰
                        read: false,
                        priority: 'medium',
                        actionUrl: '/c/announcements',
                        icon: 'fas fa-shield-alt',
                        color: 'text-blue-600'
                    },
                    {
                        id: 3,
                        type: 'general',
                        title: 'æ–°ã—ã„ã‚»ãƒŸãƒŠãƒ¼ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ',
                        message: 'ã€Œãƒªã‚¹ã‚¯ç®¡ç†ã®åŸºç¤ã€ã‚»ãƒŸãƒŠãƒ¼ã®å—ä»˜ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚',
                        timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000), // 1æ—¥å‰
                        read: false,
                        priority: 'low',
                        actionUrl: '/c/seminars',
                        icon: 'fas fa-calendar-alt',
                        color: 'text-green-600'
                    }
                ];

                this.updateNotificationCount();
                this.updateNotificationPanel();
            }

            // é€šçŸ¥ãƒ‘ãƒãƒ«é–‹é–‰
            toggleNotificationPanel() {
                const panel = document.getElementById('notification-panel');
                if (panel) {
                    panel.classList.toggle('hidden');
                    
                    if (!panel.classList.contains('hidden')) {
                        this.updateNotificationPanel();
                    }
                }
            }

            // é€šçŸ¥ãƒ‘ãƒãƒ«æ›´æ–°
            updateNotificationPanel() {
                const list = document.getElementById('notification-list');
                if (!list) return;

                if (this.notifications.length === 0) {
                    list.innerHTML = `
                        <div class="p-8 text-center text-gray-500">
                            <i class="fas fa-bell-slash text-4xl mb-4 opacity-50"></i>
                            <p>æ–°ã—ã„é€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                        </div>
                    `;
                    return;
                }

                list.innerHTML = this.notifications.map(notification => `
                    <div class="p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer ${!notification.read ? 'bg-blue-50' : ''}" 
                         onclick="notificationManager.handleNotificationClick(${notification.id})">
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center">
                                    <i class="${notification.icon} ${notification.color}"></i>
                                </div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-1">
                                    <h4 class="text-sm font-medium text-gray-900 truncate">
                                        ${notification.title}
                                        ${!notification.read ? '<span class="ml-2 w-2 h-2 bg-blue-600 rounded-full inline-block"></span>' : ''}
                                    </h4>
                                    <span class="text-xs text-gray-500">${this.formatNotificationTime(notification.timestamp)}</span>
                                </div>
                                <p class="text-sm text-gray-600 line-clamp-2">${notification.message}</p>
                                ${notification.priority === 'high' ? '<span class="inline-block mt-1 px-2 py-1 text-xs bg-red-100 text-red-700 rounded-full">ç·Šæ€¥</span>' : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // é€šçŸ¥æ•°æ›´æ–°
            updateNotificationCount() {
                const unreadNotifications = this.notifications.filter(n => !n.read);
                this.unreadCount = unreadNotifications.length;
                
                const countElement = document.getElementById('notification-count');
                if (countElement) {
                    if (this.unreadCount > 0) {
                        countElement.textContent = this.unreadCount;
                        countElement.classList.remove('hidden');
                    } else {
                        countElement.classList.add('hidden');
                    }
                }
            }

            // å…¨ã¦æ—¢èª­ã«ã™ã‚‹
            markAllAsRead() {
                this.notifications.forEach(notification => {
                    notification.read = true;
                });
                
                this.updateNotificationCount();
                this.updateNotificationPanel();
                
                this.showToast('ã™ã¹ã¦ã®é€šçŸ¥ã‚’æ—¢èª­ã«ã—ã¾ã—ãŸ', 'success');
            }

            // é€šçŸ¥ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
            handleNotificationClick(notificationId) {
                const notification = this.notifications.find(n => n.id === notificationId);
                if (!notification) return;

                // æœªèª­ã‚’æ—¢èª­ã«ã™ã‚‹
                if (!notification.read) {
                    notification.read = true;
                    this.updateNotificationCount();
                    this.updateNotificationPanel();
                }

                // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³URLãŒã‚ã‚‹å ´åˆã¯ãƒšãƒ¼ã‚¸ç§»å‹•
                if (notification.actionUrl && window.clientPortal) {
                    const page = notification.actionUrl.split('/').pop();
                    window.clientPortal.showPage(page);
                }

                // ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
                document.getElementById('notification-panel')?.classList.add('hidden');
            }

            // æ–°ã—ã„é€šçŸ¥ã‚’è¿½åŠ 
            addNotification(type, title, message, priority = 'medium', actionUrl = null) {
                const notification = {
                    id: Date.now(),
                    type,
                    title,
                    message,
                    timestamp: new Date(),
                    read: false,
                    priority,
                    actionUrl,
                    icon: this.getTypeIcon(type),
                    color: this.getTypeColor(type)
                };

                this.notifications.unshift(notification);
                
                // æœ€å¤§50ä»¶ã¾ã§ä¿æŒ
                if (this.notifications.length > 50) {
                    this.notifications = this.notifications.slice(0, 50);
                }

                this.updateNotificationCount();
                this.updateNotificationPanel();

                // ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥
                if (this.settings.browserNotifications && 'Notification' in window && Notification.permission === 'granted') {
                    new Notification(title, {
                        body: message,
                        icon: '/favicon.ico', // ã‚¢ã‚¤ã‚³ãƒ³ãƒ‘ã‚¹ã¯å®Ÿéš›ã®ã‚‚ã®ã«å¤‰æ›´
                        tag: notification.id.toString()
                    });
                }

                // é«˜å„ªå…ˆåº¦ã®å ´åˆã¯ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
                if (priority === 'high') {
                    this.showToast(title, 'warning');
                }
            }

            // æ”¯æ‰•æœŸé™ãƒã‚§ãƒƒã‚¯ãƒ»é€šçŸ¥
            startPaymentReminders() {
                // å®Ÿéš›ã®å®Ÿè£…ã§ã¯å®šæœŸçš„ã«ãƒã‚§ãƒƒã‚¯
                this.checkPaymentDueDates();
                
                // 1æ™‚é–“ã”ã¨ã«ãƒã‚§ãƒƒã‚¯
                setInterval(() => {
                    this.checkPaymentDueDates();
                }, 60 * 60 * 1000);
            }

            checkPaymentDueDates() {
                if (!window.billingManager) return;

                const invoices = window.billingManager.invoices || [];
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                invoices.filter(invoice => invoice.status === 'pending').forEach(invoice => {
                    const dueDate = new Date(invoice.due_date);
                    dueDate.setHours(0, 0, 0, 0);
                    
                    const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));

                    // é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ãƒã‚§ãƒƒã‚¯
                    if (this.settings.paymentReminders.days14 && daysDiff === 14) {
                        this.addNotification('payment', 'æ”¯æ‰•æœŸé™ã¾ã§14æ—¥', 
                            `è«‹æ±‚æ›¸ ${invoice.invoice_number} ã®æ”¯æ‰•æœŸé™ã¾ã§14æ—¥ã§ã™ï¼ˆÂ¥${this.formatNumber(invoice.total_amount)}ï¼‰`, 
                            'medium', '/c/billing');
                    } else if (this.settings.paymentReminders.days7 && daysDiff === 7) {
                        this.addNotification('payment', 'æ”¯æ‰•æœŸé™ã¾ã§7æ—¥', 
                            `è«‹æ±‚æ›¸ ${invoice.invoice_number} ã®æ”¯æ‰•æœŸé™ã¾ã§1é€±é–“ã§ã™ï¼ˆÂ¥${this.formatNumber(invoice.total_amount)}ï¼‰`, 
                            'medium', '/c/billing');
                    } else if (this.settings.paymentReminders.days3 && daysDiff === 3) {
                        this.addNotification('payment', 'æ”¯æ‰•æœŸé™ã¾ã§3æ—¥', 
                            `è«‹æ±‚æ›¸ ${invoice.invoice_number} ã®æ”¯æ‰•æœŸé™ã¾ã§3æ—¥ã§ã™ï¼ˆÂ¥${this.formatNumber(invoice.total_amount)}ï¼‰`, 
                            'high', '/c/billing');
                    } else if (this.settings.paymentReminders.sameDay && daysDiff === 0) {
                        this.addNotification('payment', 'æ”¯æ‰•æœŸé™å½“æ—¥', 
                            `è«‹æ±‚æ›¸ ${invoice.invoice_number} ã®æ”¯æ‰•æœŸé™ã¯ä»Šæ—¥ã§ã™ï¼ˆÂ¥${this.formatNumber(invoice.total_amount)}ï¼‰`, 
                            'high', '/c/billing');
                    } else if (this.settings.paymentReminders.overdue && daysDiff < 0) {
                        this.addNotification('payment', 'æ”¯æ‰•æœŸé™è¶…é', 
                            `è«‹æ±‚æ›¸ ${invoice.invoice_number} ã®æ”¯æ‰•æœŸé™ãŒ${Math.abs(daysDiff)}æ—¥è¶…éã—ã¦ã„ã¾ã™ï¼ˆÂ¥${this.formatNumber(invoice.total_amount)}ï¼‰`, 
                            'high', '/c/billing');
                    }
                });
            }

            // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥è¡¨ç¤º
            showToast(message, type = 'info') {
                const container = document.getElementById('notification-toast-container');
                if (!container) return;

                const toastId = 'toast-' + Date.now();
                const colors = {
                    success: 'bg-green-500',
                    warning: 'bg-yellow-500',
                    error: 'bg-red-500',
                    info: 'bg-blue-500'
                };

                const toast = document.createElement('div');
                toast.id = toastId;
                toast.className = `${colors[type]} text-white px-4 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 flex items-center space-x-3`;
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'times' : 'info'}-circle"></i>
                    <span class="flex-1">${message}</span>
                    <button onclick="document.getElementById('${toastId}').remove()" class="text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                `;

                container.appendChild(toast);

                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                setTimeout(() => toast.classList.remove('translate-x-full'), 100);

                // è‡ªå‹•å‰Šé™¤
                setTimeout(() => {
                    toast.classList.add('translate-x-full');
                    setTimeout(() => toast.remove(), 300);
                }, 5000);
            }

            // è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º/éè¡¨ç¤º
            showSettingsModal() {
                document.getElementById('notification-settings-modal')?.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            hideSettingsModal() {
                document.getElementById('notification-settings-modal')?.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }

            saveSettings() {
                // å®Ÿéš›ã®è¨­å®šä¿å­˜å‡¦ç†ã‚’ã“ã“ã«å®Ÿè£…
                this.hideSettingsModal();
                this.showToast('é€šçŸ¥è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
            }

            // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¡ã‚½ãƒƒãƒ‰
            getTypeIcon(type) {
                const icons = {
                    payment: 'fas fa-credit-card',
                    urgent: 'fas fa-exclamation-triangle',
                    general: 'fas fa-info-circle',
                    security: 'fas fa-shield-alt',
                    system: 'fas fa-cog'
                };
                return icons[type] || 'fas fa-bell';
            }

            getTypeColor(type) {
                const colors = {
                    payment: 'text-blue-600',
                    urgent: 'text-red-600',
                    general: 'text-green-600',
                    security: 'text-yellow-600',
                    system: 'text-gray-600'
                };
                return colors[type] || 'text-gray-600';
            }

            formatNotificationTime(timestamp) {
                const now = new Date();
                const diff = now - timestamp;
                const minutes = Math.floor(diff / (1000 * 60));
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);

                if (minutes < 1) return 'ä»Š';
                if (minutes < 60) return `${minutes}åˆ†å‰`;
                if (hours < 24) return `${hours}æ™‚é–“å‰`;
                if (days < 7) return `${days}æ—¥å‰`;
                return timestamp.toLocaleDateString('ja-JP');
            }

            formatNumber(number) {
                return new Intl.NumberFormat('ja-JP').format(number);
            }
        }

        // ====================
        // ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆç®¡ç†ã‚¯ãƒ©ã‚¹
        // ====================
        class ReportManager {
            constructor() {
                this.reports = [];
                this.charts = {};
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadReportData();
                this.initializeCharts();
                this.loadReportsHistory();
                
                console.log('ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½åˆæœŸåŒ–å®Œäº†');
            }

            setupEventListeners() {
                document.getElementById('generate-custom-report-btn')?.addEventListener('click', () => {
                    this.showCustomReportDialog();
                });
            }

            // ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            loadReportData() {
                // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ billingManager ãªã©ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                this.reportData = {
                    monthly: {
                        labels: ['4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ'],
                        invoiceAmounts: [180000, 220000, 195000, 352000, 165000],
                        serviceUsage: [3, 4, 2, 6, 2]
                    },
                    services: {
                        labels: ['æœˆé¡åŸºæœ¬æ–™', 'ç·Šæ€¥å‡ºå‹•', 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®', 'é˜²çŠ¯ã‚«ãƒ¡ãƒ©', 'æ³•çš„æ›¸é¡'],
                        amounts: [165000, 352000, 88000, 495000, 120000],
                        colors: ['#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6']
                    },
                    kpis: {
                        totalPayment: 2340000,
                        serviceCount: 24,
                        responseTime: 2.4,
                        satisfaction: 4.8
                    }
                };
            }

            // ãƒãƒ£ãƒ¼ãƒˆåˆæœŸåŒ–
            initializeCharts() {
                this.initMonthlyChart();
                this.initServicePieChart();
            }

            // æœˆæ¬¡æ¨ç§»ã‚°ãƒ©ãƒ•
            initMonthlyChart() {
                const ctx = document.getElementById('monthly-chart');
                if (!ctx) return;

                this.charts.monthly = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: this.reportData.monthly.labels,
                        datasets: [{
                            label: 'è«‹æ±‚é¡ï¼ˆå††ï¼‰',
                            data: this.reportData.monthly.invoiceAmounts,
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#3B82F6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                callbacks: {
                                    label: function(context) {
                                        return `è«‹æ±‚é¡: Â¥${context.parsed.y.toLocaleString()}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return `Â¥${(value / 1000)}k`;
                                    }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        }
                    }
                });
            }

            // ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨å‰²åˆå††ã‚°ãƒ©ãƒ•
            initServicePieChart() {
                const ctx = document.getElementById('service-pie-chart');
                if (!ctx) return;

                this.charts.servicePie = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: this.reportData.services.labels,
                        datasets: [{
                            data: this.reportData.services.amounts,
                            backgroundColor: this.reportData.services.colors,
                            borderWidth: 0,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                callbacks: {
                                    label: function(context) {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        return `${context.label}: Â¥${context.parsed.toLocaleString()} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        cutout: '60%'
                    }
                });
            }

            // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
            async generateReport(type) {
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹è¡¨ç¤º
                if (window.notificationManager) {
                    window.notificationManager.showToast('ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™...', 'info');
                }

                // å®Ÿéš›ã®ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                setTimeout(() => {
                    const report = this.createReportData(type);
                    this.downloadReport(report);
                    
                    if (window.notificationManager) {
                        window.notificationManager.showToast('ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ', 'success');
                    }

                    // å±¥æ­´ã«è¿½åŠ 
                    this.addToReportsHistory(report);
                }, 2000);
            }

            // ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
            createReportData(type) {
                const now = new Date();
                const reportTypes = {
                    monthly: {
                        name: 'æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ',
                        period: `${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆ`,
                        type: 'æœˆæ¬¡'
                    },
                    yearly: {
                        name: 'å¹´æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ', 
                        period: `${now.getFullYear()}å¹´`,
                        type: 'å¹´æ¬¡'
                    },
                    cost: {
                        name: 'ã‚³ã‚¹ãƒˆåˆ†æãƒ¬ãƒãƒ¼ãƒˆ',
                        period: `${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆ`,
                        type: 'ã‚³ã‚¹ãƒˆåˆ†æ'
                    },
                    performance: {
                        name: 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ',
                        period: `${now.getFullYear()}å¹´Q${Math.ceil((now.getMonth() + 1) / 3)}`,
                        type: 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹'
                    }
                };

                const reportInfo = reportTypes[type] || reportTypes.monthly;

                return {
                    id: Date.now(),
                    ...reportInfo,
                    createdAt: now,
                    data: this.generateReportContent(type)
                };
            }

            // ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ç”Ÿæˆ
            generateReportContent(type) {
                switch (type) {
                    case 'monthly':
                        return {
                            totalInvoices: 3,
                            totalAmount: 517000,
                            paidAmount: 253000,
                            pendingAmount: 264000,
                            serviceBreakdown: this.reportData.services,
                            summary: 'ä»Šæœˆã¯ç·Šæ€¥å‡ºå‹•ãŒ1ä»¶ç™ºç”Ÿã—ã€é€šå¸¸ã‚ˆã‚Šè«‹æ±‚é¡ãŒå¢—åŠ ã—ã¦ã„ã¾ã™ã€‚'
                        };
                    case 'yearly':
                        return {
                            totalInvoices: 28,
                            totalAmount: 2340000,
                            averageMonthly: 195000,
                            serviceGrowth: '+15%',
                            costReduction: '-8%',
                            summary: 'å¹´é–“ã‚’é€šã˜ã¦å®‰å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨ãŒã‚ã‚Šã€ã‚³ã‚¹ãƒˆåŠ¹ç‡ã‚‚æ”¹å–„ã—ã¦ã„ã¾ã™ã€‚'
                        };
                    case 'cost':
                        return {
                            serviceEfficiency: {
                                'ã‚«ã‚¹ãƒãƒ©å¯¾å¿œ': 'Â¥88,000/ä»¶',
                                'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®': 'Â¥22,000/äºº',
                                'é˜²çŠ¯ã‚«ãƒ¡ãƒ©': 'Â¥165,000/ã‚·ã‚¹ãƒ†ãƒ '
                            },
                            roi: '+245%',
                            costSavings: 'Â¥480,000/å¹´',
                            summary: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æŠ•è³‡ã«ã‚ˆã‚Šäº‹æ•…é–¢é€£ã‚³ã‚¹ãƒˆã‚’å¤§å¹…ã«å‰Šæ¸›ã§ãã¦ã„ã¾ã™ã€‚'
                        };
                    case 'performance':
                        return {
                            responseTime: '2.4æ™‚é–“',
                            resolutionRate: '98.5%',
                            customerSatisfaction: '4.8/5.0',
                            incidentPrevention: '+67%',
                            summary: 'é«˜ã„ã‚µãƒ¼ãƒ“ã‚¹å“è³ªã‚’ç¶­æŒã—ã€äºˆé˜²åŠ¹æœã‚‚å‘ä¸Šã—ã¦ã„ã¾ã™ã€‚'
                        };
                    default:
                        return {};
                }
            }

            // ãƒ¬ãƒãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆç°¡æ˜“ç‰ˆï¼‰
            downloadReport(report) {
                const content = this.formatReportForDownload(report);
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${report.name}_${report.period}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            formatReportForDownload(report) {
                let content = `ã‚¹ãƒãƒ¼ãƒˆãƒãƒªã‚¹ ${report.name}\n`;
                content += `å¯¾è±¡æœŸé–“: ${report.period}\n`;
                content += `ä½œæˆæ—¥: ${report.createdAt.toLocaleDateString('ja-JP')}\n`;
                content += `\n${'='.repeat(50)}\n\n`;

                // ãƒ‡ãƒ¼ã‚¿å†…å®¹ã‚’æ•´å½¢
                if (report.data) {
                    Object.entries(report.data).forEach(([key, value]) => {
                        if (typeof value === 'object') {
                            content += `${key}:\n`;
                            Object.entries(value).forEach(([subKey, subValue]) => {
                                content += `  - ${subKey}: ${subValue}\n`;
                            });
                        } else {
                            content += `${key}: ${value}\n`;
                        }
                    });
                }

                content += `\n${'='.repeat(50)}\n`;
                content += `\nã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯ã‚¹ãƒãƒ¼ãƒˆãƒãƒªã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚\n`;
                content += `è©³ç´°ãªåˆ†æã‚„è¿½åŠ ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ãªå ´åˆã¯ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚\n`;

                return content;
            }

            // ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´èª­ã¿è¾¼ã¿
            loadReportsHistory() {
                // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
                const sampleReports = [
                    {
                        id: 1,
                        name: 'æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ',
                        type: 'æœˆæ¬¡',
                        period: '2024å¹´7æœˆ',
                        createdAt: new Date('2024-08-01')
                    },
                    {
                        id: 2,
                        name: 'ã‚³ã‚¹ãƒˆåˆ†æãƒ¬ãƒãƒ¼ãƒˆ',
                        type: 'ã‚³ã‚¹ãƒˆåˆ†æ', 
                        period: '2024å¹´Q2',
                        createdAt: new Date('2024-07-15')
                    },
                    {
                        id: 3,
                        name: 'å¹´æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ',
                        type: 'å¹´æ¬¡',
                        period: '2023å¹´',
                        createdAt: new Date('2024-01-31')
                    }
                ];

                this.reports = sampleReports;
                this.updateReportsTable();
            }

            // ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
            updateReportsTable() {
                const tbody = document.getElementById('reports-table-body');
                if (!tbody) return;

                tbody.innerHTML = this.reports.map(report => `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <i class="fas fa-file-alt text-blue-500 mr-3"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">${report.name}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                ${report.type}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${report.period}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${report.createdAt.toLocaleDateString('ja-JP')}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                            <button onclick="reportManager.downloadExistingReport(${report.id})" class="text-blue-600 hover:text-blue-900 focus-ring rounded">
                                <i class="fas fa-download mr-1"></i>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                            </button>
                            <button onclick="reportManager.deleteReport(${report.id})" class="text-red-600 hover:text-red-900 focus-ring rounded">
                                <i class="fas fa-trash mr-1"></i>å‰Šé™¤
                            </button>
                        </td>
                    </tr>
                `).join('');
            }

            // æ—¢å­˜ãƒ¬ãƒãƒ¼ãƒˆå†ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            downloadExistingReport(reportId) {
                const report = this.reports.find(r => r.id === reportId);
                if (!report) return;

                if (window.notificationManager) {
                    window.notificationManager.showToast('ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™...', 'info');
                }

                // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ä¿å­˜ã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                setTimeout(() => {
                    const content = `ã‚¹ãƒãƒ¼ãƒˆãƒãƒªã‚¹ ${report.name}\nå¯¾è±¡æœŸé–“: ${report.period}\nä½œæˆæ—¥: ${report.createdAt.toLocaleDateString('ja-JP')}\n\nâ€»ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯éå»ã«ç”Ÿæˆã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚`;
                    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${report.name}_${report.period}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    if (window.notificationManager) {
                        window.notificationManager.showToast('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                    }
                }, 1000);
            }

            // ãƒ¬ãƒãƒ¼ãƒˆå‰Šé™¤
            deleteReport(reportId) {
                if (!confirm('ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

                this.reports = this.reports.filter(r => r.id !== reportId);
                this.updateReportsTable();

                if (window.notificationManager) {
                    window.notificationManager.showToast('ãƒ¬ãƒãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                }
            }

            // å±¥æ­´ã«è¿½åŠ 
            addToReportsHistory(report) {
                this.reports.unshift(report);
                
                // æœ€å¤§50ä»¶ã¾ã§ä¿æŒ
                if (this.reports.length > 50) {
                    this.reports = this.reports.slice(0, 50);
                }
                
                this.updateReportsTable();
            }

            // ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            showCustomReportDialog() {
                alert('ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã§ã™ã€‚\n\nãƒ»æœŸé–“æŒ‡å®šãƒ¬ãƒãƒ¼ãƒˆ\nãƒ»è¤‡æ•°æ¡ä»¶ãƒ•ã‚£ãƒ«ã‚¿\nãƒ»ã‚°ãƒ©ãƒ•å‡ºåŠ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³\nãƒ»Excel/PDFå‡ºåŠ›');
            }
        }

        function downloadInvoicePDF(invoiceId) {
            if (window.billingManager) {
                window.billingManager.downloadInvoicePDF(invoiceId);
            }
        }

        function showPaymentOptions(invoiceId) {
            if (window.billingManager) {
                window.billingManager.showPaymentOptions(invoiceId);
            }
        }
    </script>
</body>
</html>